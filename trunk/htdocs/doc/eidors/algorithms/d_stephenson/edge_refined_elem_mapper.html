<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of edge_refined_elem_mapper</title>
  <meta name="keywords" content="edge_refined_elem_mapper">
  <meta name="description" content="EDGE_REFINED_ELEM_MAPPER: map elements from coarse to dense model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html eidors --><!-- ../menu.html algorithms --><!-- menu.html d_stephenson -->
<h1>edge_refined_elem_mapper
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>EDGE_REFINED_ELEM_MAPPER: map elements from coarse to dense model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [index_simp]=edge_refined_elem_mapper( mdl_coarse, mdl_dense) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> EDGE_REFINED_ELEM_MAPPER: map elements from coarse to dense model
 Calculates the index array mapping each dense mesh (from netgen)
  simp onto a coarse mesh (from netgen) simp.

 Usage:
  [index_simp]=edge_refined_elem_mapper( mdl_coarse, mdl_dense)

 (C) 2005 David Stephenson. Licensed under GPL v 2
 $Id$</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="center_of_simps.html" class="code" title="function [center_simp]=center_of_simps(fwd_model, extraparam)">center_of_simps</a>	CENTER_OF_SIMPS: Calculates the Center of Mass of the Simplicies.</li><li><a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG: eidors progress and status messages</li><li><a href="../../../eidors/eidors_obj.html" class="code" title="function obj_id= eidors_obj(type,name, varargin );">eidors_obj</a>	EIDORS_OBJ: 'constructor' to create a eidors structure</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="inv_solve_dual_mesh.html" class="code" title="function img= inv_solve_dual_mesh( inv_model, voltage)">inv_solve_dual_mesh</a>	INV_SOLVE_DUAL_MESH using a coarse and fine mesh</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [lookup]=lookup_bld(simp_coarse,simp_dense);</a></li><li><a href="#_sub2" class="code">function [vtx_midpoints]=midpoints(vtx,simp);</a></li><li><a href="#_sub3" class="code">function [center_h_refined_simps]=calc_h_refinement_centers(simp,vtx,vtx_midpoints);</a></li><li><a href="#_sub4" class="code">function [index_simp] = calc_simp_index(simp_dense,centre_simp_dense,center_h_refined_simps,lookup);</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [index_simp]=edge_refined_elem_mapper( mdl_coarse, mdl_dense)</a>
0002 <span class="comment">% EDGE_REFINED_ELEM_MAPPER: map elements from coarse to dense model</span>
0003 <span class="comment">% Calculates the index array mapping each dense mesh (from netgen)</span>
0004 <span class="comment">%  simp onto a coarse mesh (from netgen) simp.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Usage:</span>
0007 <span class="comment">%  [index_simp]=edge_refined_elem_mapper( mdl_coarse, mdl_dense)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% (C) 2005 David Stephenson. Licensed under GPL v 2</span>
0010 <span class="comment">% $Id$</span>
0011 
0012 index_simp = <a href="../../../eidors/eidors_obj.html" class="code" title="function obj_id= eidors_obj(type,name, varargin );">eidors_obj</a>(<span class="string">'get-cache'</span>, mdl_dense, <span class="string">'index_simp'</span>, mdl_coarse);
0013 <span class="keyword">if</span> ~isempty(index_simp)
0014     <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'edge_refined_elem_mapper: using cached value'</span>, 2);
0015     <span class="keyword">return</span>
0016 <span class="keyword">end</span>
0017 
0018 vtx_coarse =  mdl_coarse.nodes;
0019 simp_coarse = mdl_coarse.elems;
0020 vtx_dense =  mdl_dense.nodes;
0021 simp_dense = mdl_dense.elems;
0022 
0023 <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'edge_refined_elem_mapper: lookup_bld'</span>,4);
0024 [lookup]=<a href="#_sub1" class="code" title="subfunction [lookup]=lookup_bld(simp_coarse,simp_dense);">lookup_bld</a>(simp_coarse,simp_dense);
0025 
0026 <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'edge_refined_elem_mapper: center_of_simps'</span>,4);
0027 [center_simp_dense]=<a href="center_of_simps.html" class="code" title="function [center_simp]=center_of_simps(fwd_model, extraparam)">center_of_simps</a>(simp_dense, vtx_dense);
0028 
0029 <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'edge_refined_elem_mapper: midpoints'</span>,4);
0030 [vtx_midpoints_coarse]=<a href="#_sub2" class="code" title="subfunction [vtx_midpoints]=midpoints(vtx,simp);">midpoints</a>(vtx_coarse,simp_coarse);
0031 
0032 <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'edge_refined_elem_mapper: calc_h_refinement_centers'</span>,4);
0033 [center_h_refined_simps]=<a href="#_sub3" class="code" title="subfunction [center_h_refined_simps]=calc_h_refinement_centers(simp,vtx,vtx_midpoints);">calc_h_refinement_centers</a>(simp_coarse,vtx_coarse,vtx_midpoints_coarse);
0034 
0035 <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'edge_refined_elem_mapper: calc_simp_index'</span>,4);
0036 [index_simp] = <a href="#_sub4" class="code" title="subfunction [index_simp] = calc_simp_index(simp_dense,centre_simp_dense,center_h_refined_simps,lookup);">calc_simp_index</a>(simp_dense,center_simp_dense,center_h_refined_simps,lookup);
0037 
0038 <span class="comment">% Cache the restult - it depends on both dense and coarse mdl</span>
0039 <a href="../../../eidors/eidors_obj.html" class="code" title="function obj_id= eidors_obj(type,name, varargin );">eidors_obj</a>(<span class="string">'set-cache'</span>, mdl_dense, <span class="string">'index_simp'</span>, index_simp, mdl_coarse);
0040 <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'edge_refined_elem_mapper: setting cached value'</span>, 2);
0041 
0042 
0043 <a name="_sub1" href="#_subfunctions" class="code">function [lookup]=lookup_bld(simp_coarse,simp_dense);</a>
0044 
0045 <span class="comment">% This function calculates the lookup matrix of the dual mesh system (h-refinement) &amp; is used for calculating index_simp.</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% simp_coarse = the coarse mesh simp array.</span>
0048 <span class="comment">% simp_dense = the dense mesh simp array.</span>
0049 
0050 a=size(simp_coarse,1); <span class="comment">% i.e the number of coarse mesh elements</span>
0051 b=size(simp_dense,1); <span class="comment">% i.e the number of dense mesh elements</span>
0052 
0053 lookup=zeros(b,1);
0054 
0055 x=1;
0056 y=8;
0057 
0058 <span class="keyword">for</span> i=1:a;
0059     
0060     <span class="keyword">for</span> ii=x:y;
0061         
0062         lookup(ii)=i;
0063         
0064         ii=ii+1;
0065         
0066     <span class="keyword">end</span>
0067     
0068     x=x+8;
0069     y=y+8;
0070     
0071 <span class="keyword">end</span>
0072 
0073 
0074 <a name="_sub2" href="#_subfunctions" class="code">function [vtx_midpoints]=midpoints(vtx,simp);</a>
0075 
0076 <span class="comment">% Calculates The x y z co-ordinates of the 6 midpoints of a 4 node simp.</span>
0077 <span class="comment">%</span>
0078 <span class="comment">% vtx = The vertices matrix</span>
0079 <span class="comment">% simp = The simplices matrix</span>
0080 <span class="comment">% vtx_midpoints = The x y z co-ordinates of the 6 midpoints of a 4 node simp</span>
0081 
0082 <span class="comment">% Preallocation</span>
0083 
0084 vtx_midpoints=zeros(size(simp,1),18);
0085 
0086 <span class="keyword">for</span> i=1:size(simp,1);
0087     
0088     <span class="comment">% Simp node 1~2</span>
0089     x1=vtx(simp(i,1),1);
0090     y1=vtx(simp(i,1),2);
0091     z1=vtx(simp(i,1),3);
0092     x2=vtx(simp(i,2),1);
0093     y2=vtx(simp(i,2),2);
0094     z2=vtx(simp(i,2),3);
0095 
0096     
0097     x_mid=((x1+x2)/2);
0098     y_mid=((y1+y2)/2);
0099     z_mid=((z1+z2)/2);
0100     
0101     vtx_midpoints(i,1)=x_mid;
0102     vtx_midpoints(i,2)=y_mid;
0103     vtx_midpoints(i,3)=z_mid;
0104     
0105     <span class="comment">% Simp node 1~3</span>
0106     x1=vtx(simp(i,1),1);
0107     y1=vtx(simp(i,1),2);
0108     z1=vtx(simp(i,1),3);
0109     x2=vtx(simp(i,3),1);
0110     y2=vtx(simp(i,3),2);
0111     z2=vtx(simp(i,3),3);
0112     
0113     x_mid=((x1+x2)/2);
0114     y_mid=((y1+y2)/2);
0115     z_mid=((z1+z2)/2);
0116     
0117     vtx_midpoints(i,4)=x_mid;
0118     vtx_midpoints(i,5)=y_mid;
0119     vtx_midpoints(i,6)=z_mid;
0120     
0121     <span class="comment">% Simp node 1~4</span>
0122     x1=vtx(simp(i,1),1);
0123     y1=vtx(simp(i,1),2);
0124     z1=vtx(simp(i,1),3);
0125     x2=vtx(simp(i,4),1);
0126     y2=vtx(simp(i,4),2);
0127     z2=vtx(simp(i,4),3);
0128     
0129     x_mid=((x1+x2)/2);
0130     y_mid=((y1+y2)/2);
0131     z_mid=((z1+z2)/2);
0132     
0133     vtx_midpoints(i,7)=x_mid;
0134     vtx_midpoints(i,8)=y_mid;
0135     vtx_midpoints(i,9)=z_mid;
0136     
0137     <span class="comment">% Simp node 2~3</span>
0138     x1=vtx(simp(i,2),1);
0139     y1=vtx(simp(i,2),2);
0140     z1=vtx(simp(i,2),3);
0141     x2=vtx(simp(i,3),1);
0142     y2=vtx(simp(i,3),2);
0143     z2=vtx(simp(i,3),3);
0144    
0145     x_mid=((x1+x2)/2);
0146     y_mid=((y1+y2)/2);
0147     z_mid=((z1+z2)/2);
0148     
0149     vtx_midpoints(i,10)=x_mid;
0150     vtx_midpoints(i,11)=y_mid;
0151     vtx_midpoints(i,12)=z_mid;
0152 
0153     
0154     <span class="comment">% Simp node 2~4</span>
0155     x1=vtx(simp(i,2),1);
0156     y1=vtx(simp(i,2),2);
0157     z1=vtx(simp(i,2),3);
0158     x2=vtx(simp(i,4),1);
0159     y2=vtx(simp(i,4),2);
0160     z2=vtx(simp(i,4),3);
0161     
0162     x_mid=((x1+x2)/2);
0163     y_mid=((y1+y2)/2);
0164     z_mid=((z1+z2)/2);
0165     
0166     vtx_midpoints(i,13)=x_mid;
0167     vtx_midpoints(i,14)=y_mid;
0168     vtx_midpoints(i,15)=z_mid;
0169     
0170     <span class="comment">% Simp node 3~4</span>
0171     x1=vtx(simp(i,3),1);
0172     y1=vtx(simp(i,3),2);
0173     z1=vtx(simp(i,3),3);
0174     x2=vtx(simp(i,4),1);
0175     y2=vtx(simp(i,4),2);
0176     z2=vtx(simp(i,4),3);
0177     
0178     x_mid=((x1+x2)/2);
0179     y_mid=((y1+y2)/2);
0180     z_mid=((z1+z2)/2);
0181     
0182     vtx_midpoints(i,16)=x_mid;
0183     vtx_midpoints(i,17)=y_mid;
0184     vtx_midpoints(i,18)=z_mid;
0185     
0186     i=i+1;
0187     
0188 <span class="keyword">end</span>
0189 
0190 <a name="_sub3" href="#_subfunctions" class="code">function [center_h_refined_simps]=calc_h_refinement_centers(simp,vtx,vtx_midpoints);</a>
0191 
0192 <span class="comment">% This function calculates the center of mass of each h-refined simp from the coarse mesh.</span>
0193 <span class="comment">%</span>
0194 <span class="comment">% vtx      = The vertices matrix</span>
0195 <span class="comment">% simp     = The simplices matrix</span>
0196 <span class="comment">% vtx_midpoints  = The x y z co-ordinates of the 6 midpoints of a 4 node simp</span>
0197 <span class="comment">% center_h_refined_simps = the center of mass of each h-refined simp from the coarse mesh</span>
0198 
0199 vtx_dave_1=[];
0200 vtx_dave_2=[];
0201 simp_dave=[1 5 6 7;2 5 8 9;3 6 8 10;4 7 9 10;5 6 7 9;5 6 8 9;6 7 9 10;6 8 9 10];
0202 center_simp_proximity=[];
0203 
0204 <span class="keyword">for</span> i=1:size(simp,1);
0205     
0206     vtx_dave_1(1,1)=vtx(simp(i,1),1);
0207     vtx_dave_1(1,2)=vtx(simp(i,1),2);
0208     vtx_dave_1(1,3)=vtx(simp(i,1),3);
0209     
0210     vtx_dave_1(2,1)=vtx(simp(i,2),1);
0211     vtx_dave_1(2,2)=vtx(simp(i,2),2);
0212     vtx_dave_1(2,3)=vtx(simp(i,2),3);
0213     
0214     vtx_dave_1(3,1)=vtx(simp(i,3),1);
0215     vtx_dave_1(3,2)=vtx(simp(i,3),2);
0216     vtx_dave_1(3,3)=vtx(simp(i,3),3);
0217     
0218     vtx_dave_1(4,1)=vtx(simp(i,4),1);
0219     vtx_dave_1(4,2)=vtx(simp(i,4),2);
0220     vtx_dave_1(4,3)=vtx(simp(i,4),3);
0221     
0222     vtx_dave_2(1,1)=vtx_midpoints(i,1);
0223     vtx_dave_2(1,2)=vtx_midpoints(i,2);
0224     vtx_dave_2(1,3)=vtx_midpoints(i,3);
0225     
0226     vtx_dave_2(2,1)=vtx_midpoints(i,4);
0227     vtx_dave_2(2,2)=vtx_midpoints(i,5);
0228     vtx_dave_2(2,3)=vtx_midpoints(i,6);
0229     
0230     vtx_dave_2(3,1)=vtx_midpoints(i,7);
0231     vtx_dave_2(3,2)=vtx_midpoints(i,8);
0232     vtx_dave_2(3,3)=vtx_midpoints(i,9);
0233     
0234     vtx_dave_2(4,1)=vtx_midpoints(i,10);
0235     vtx_dave_2(4,2)=vtx_midpoints(i,11);
0236     vtx_dave_2(4,3)=vtx_midpoints(i,12);
0237     
0238     vtx_dave_2(5,1)=vtx_midpoints(i,13);
0239     vtx_dave_2(5,2)=vtx_midpoints(i,14);
0240     vtx_dave_2(5,3)=vtx_midpoints(i,15);
0241     
0242     vtx_dave_2(6,1)=vtx_midpoints(i,16);
0243     vtx_dave_2(6,2)=vtx_midpoints(i,17);
0244     vtx_dave_2(6,3)=vtx_midpoints(i,18);
0245     
0246     vtx_dave=[vtx_dave_1;vtx_dave_2];
0247     
0248     [center_simp_dave]=<a href="center_of_simps.html" class="code" title="function [center_simp]=center_of_simps(fwd_model, extraparam)">center_of_simps</a>(simp_dave,vtx_dave);
0249     
0250     center_simp_proximity=[center_simp_proximity;center_simp_dave];
0251     
0252     vtx_dave_1=[];
0253     vtx_dave_2=[];
0254     
0255     i=i+1;
0256     
0257 <span class="keyword">end</span>
0258 
0259 center_h_refined_simps=center_simp_proximity;
0260 
0261 
0262 
0263 <a name="_sub4" href="#_subfunctions" class="code">function [index_simp] = calc_simp_index(simp_dense,centre_simp_dense,center_h_refined_simps,lookup);</a>
0264 
0265 <span class="comment">% Calculates the index array mapping each dense mesh (from netgen) simp onto a coarse mesh (from netgen) simp.</span>
0266 <span class="comment">%</span>
0267 <span class="comment">% simp_dense = The dense mesh simplices matrix</span>
0268 <span class="comment">% centre_simp_dense = The center of mass of each (netgen) dense mesh element</span>
0269 <span class="comment">% center_h_refined_simps = The center of mass of each h-refined simp from the coarse mesh</span>
0270 <span class="comment">% lookup = the lookup matrix of the dual mesh system (h-refinement)</span>
0271 
0272 <span class="comment">% Array pre-allocation</span>
0273 
0274 dist_simp=zeros(size(simp_dense,1),1);
0275 index_simp=zeros(size(simp_dense,1),2);
0276 mat_dense=zeros(size(simp_dense,1),1);
0277 
0278 <span class="comment">% Down to business ...</span>
0279 
0280 h = waitbar(0,<span class="string">'Calculating Simplex Map'</span>);
0281 
0282 <span class="keyword">for</span> id=1:size(simp_dense,1);   <span class="comment">% for all dense center of simplicies</span>
0283 
0284     waitbar(id/size(simp_dense,1))
0285 
0286     <span class="comment">% find the x,y,z co-ord difference</span>
0287     dx=centre_simp_dense(id,1)-center_h_refined_simps(:,1);
0288     dy=centre_simp_dense(id,2)-center_h_refined_simps(:,2);
0289     dz=centre_simp_dense(id,3)-center_h_refined_simps(:,3);
0290     
0291     dist_simp=sqrt((dx.^2)+(dy.^2)+(dz.^2));
0292        
0293     
0294     [m,I]=min(dist_simp);   <span class="comment">% index out the minimum distance from the dense mesh to the id'th center of simplex</span>
0295     
0296     index_simp(id,1)=lookup(I);
0297 
0298     index_simp(id,2)=m;   <span class="comment">% write the actual minimum distance (as a quality control procedure)</span>
0299     
0300 <span class="keyword">end</span>
0301 
0302 close(h)
0303 
0304 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0305 <span class="comment">% This is part of the EIDORS suite.</span>
0306 <span class="comment">% Copyright (c) D.R Stephenson 2004</span>
0307 <span class="comment">% Copying permitted under terms of GNU GPL</span>
0308 <span class="comment">% See enclosed file gpl.html for details.</span>
0309 <span class="comment">% EIDORS 3D version XXX</span>
0310 <span class="comment">% MATLAB Version 6.5.0.180913a (R13)</span>
0311 <span class="comment">% MATLAB License Number: 1560</span>
0312 <span class="comment">% Operating System: Microsoft Windows XP Version 5.1 (Build 2600: Service Pack 1)</span>
0313 <span class="comment">% Java VM Version: Java 1.3.1_01 with Sun Microsystems Inc. Java HotSpot(TM) Client VM</span>
0314 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0315 
0316 
0317</pre></div>
<hr><address>Generated on Wed 13-Jul-2011 23:23:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>