<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of calc_posn_resolution</title>
  <meta name="keywords" content="calc_posn_resolution">
  <meta name="description" content="CALC_POSN_RESOLUTION: calculate posn and resolution of a target">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html eidors --><!-- ../menu.html algorithms --><!-- menu.html a_adler -->
<h1>calc_posn_resolution
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>CALC_POSN_RESOLUTION: calculate posn and resolution of a target</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [br,pos]= calc_posn_resolution( img, fwd_model) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> CALC_POSN_RESOLUTION: calculate posn and resolution of a target
 [br,xpos,ypos]= calc_posn_resolution( img, fwd_model)
 
 img - eidors img generated by a point (or small) target
 br  - Blur radius measure of resolution
 pos - [x;y] position in terms of % radius

 These parameters are defined in Adler &amp; Graudo (1996),
  IEEE T. Medical Imaging, 5:170-179, 1996.

 br and pos will have columns for each image in img

 In 3D calc_posn_resolution does a 2D z-slice in the 
 centre of the medium. This may not be appropriate</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/graphics_matlab/calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>	[colours,scl_data]= calc_colours(img, set_value, do_colourbar)</li><li><a href="../../../eidors/graphics_matlab/calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>	calc_slices (img, levels, clim  ) show slices at levels of an</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [br,pos]= calc_posn_resolution( img, fwd_model)</a>
0002 <span class="comment">% CALC_POSN_RESOLUTION: calculate posn and resolution of a target</span>
0003 <span class="comment">% [br,xpos,ypos]= calc_posn_resolution( img, fwd_model)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% img - eidors img generated by a point (or small) target</span>
0006 <span class="comment">% br  - Blur radius measure of resolution</span>
0007 <span class="comment">% pos - [x;y] position in terms of % radius</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% These parameters are defined in Adler &amp; Graudo (1996),</span>
0010 <span class="comment">%  IEEE T. Medical Imaging, 5:170-179, 1996.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% br and pos will have columns for each image in img</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% In 3D calc_posn_resolution does a 2D z-slice in the</span>
0015 <span class="comment">% centre of the medium. This may not be appropriate</span>
0016 
0017 <span class="comment">% (C) 2006 Andy Adler. Licensed under GPL version 2</span>
0018 <span class="comment">% $Id$</span>
0019 
0020 <span class="keyword">if</span> nargin&gt;=2
0021    img.fwd_model= fwd_model;
0022 <span class="keyword">end</span>
0023 
0024 <span class="comment">% create full 'red' image</span>
0025 fimg= img;
0026 fimg.elem_data= ones(size(img.elem_data,1),1);
0027 
0028 np= 256;
0029 <span class="comment">% FIXME: if the functions have an error, then npoints is changed</span>
0030 np_save= <a href="../../../eidors/graphics_matlab/calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>(<span class="string">'npoints'</span>);
0031 <a href="../../../eidors/graphics_matlab/calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>(<span class="string">'npoints'</span>,np);
0032 
0033 <span class="keyword">if</span>     size(img.fwd_model.elems,2) == 3 <span class="comment">% 2D</span>
0034    rimg= <a href="../../../eidors/graphics_matlab/calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>( img );
0035    fimg= <a href="../../../eidors/graphics_matlab/calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>( fimg );
0036 <span class="keyword">elseif</span> size(img.fwd_model.elems,2) == 4 <span class="comment">% 3D</span>
0037    rimg= <a href="../../../eidors/graphics_matlab/calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>( img, 1 );
0038    fimg= <a href="../../../eidors/graphics_matlab/calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>( fimg, 1 );
0039 <span class="keyword">else</span>
0040    <a href="../../../eidors/graphics_matlab/calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>(<span class="string">'npoints'</span>,np_save);
0041    error(<span class="string">'N dimensions is not 2 or 3'</span>);
0042 <span class="keyword">end</span>
0043 
0044 
0045 rimg= squeeze(rimg); <span class="comment">% for 3D case</span>
0046 n_imgs= size(rimg,3);
0047 <span class="comment">% reset npoints</span>
0048 <a href="../../../eidors/graphics_matlab/calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>(<span class="string">'npoints'</span>,np_save);
0049 
0050 <span class="comment">% Process full image to get area and x,y limits</span>
0051 fimg= ~isnan(fimg);
0052 img_area= sum(fimg(:));
0053 
0054 xfind= find(any( fimg,1));
0055 img_xmin= min(xfind); img_xmax= max(xfind);
0056 img_xctr= mean([img_xmin, img_xmax]);
0057 img_xrad= [img_xmax - img_xmin]/2; <span class="comment">% radius</span>
0058 
0059 yfind= find(any( fimg,1));
0060 img_ymin= min(yfind); img_ymax= max(yfind);
0061 img_yctr= mean([img_ymin, img_ymax]);
0062 img_yrad= [img_ymax - img_ymin]/2; <span class="comment">% radius</span>
0063 
0064 br= zeros(1,n_imgs);
0065 pos=zeros(2,n_imgs);
0066 <span class="keyword">for</span> i=1:n_imgs
0067    img_i =       rimg(:,:,i);
0068    <span class="comment">% flip so image is +</span>
0069    img_i =       img_i * sign( max(img_i(:)) + min(img_i(:)));
0070    [img_i,idx] = sort(img_i(:));
0071    img_i(idx)  = cumsum(img_i .* (img_i&gt;0));
0072    ha_set = img_i &gt; max(img_i)/2;
0073    br(i) = sqrt(sum(ha_set)/img_area);
0074 
0075 <span class="comment">% create HA image</span>
0076    ha_img= zeros(np,np);
0077    ha_img( ha_set) = 1; 
0078    xpos = sum( ha_img, 1);
0079    xpos = sum( (1:np) .* xpos ) / sum( xpos );
0080    xpos = (xpos - img_xctr) / img_xrad;
0081    ypos = sum( ha_img, 2)';
0082    ypos = sum( (1:np) .* ypos ) / sum( ypos );
0083    ypos = -(ypos - img_yctr) / img_yrad; <span class="comment">% images y dirn is backward</span>
0084    pos(:,i) = [xpos;ypos];
0085 <span class="keyword">end</span>
0086    
0087    
0088</pre></div>
<hr><address>Generated on Wed 13-Jul-2011 23:23:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>