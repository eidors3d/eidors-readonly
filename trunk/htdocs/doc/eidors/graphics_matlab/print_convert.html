<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of print_convert</title>
  <meta name="keywords" content="print_convert">
  <meta name="description" content="PRINT_CONVERT: print figures and call imagemagick to trim them">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html eidors --><!-- menu.html graphics_matlab -->
<h1>print_convert
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>PRINT_CONVERT: print figures and call imagemagick to trim them</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function print_convert(filename, options, pagehwr) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> PRINT_CONVERT: print figures and call imagemagick to trim them
 print_convert(filename, options, pagehwr)

  filename: filename to print to file type is the extension
  options:  options to send to imagemagick convert (if it is available)
  pagehwr:  set page high/width to control shape of figures

  Examples
   print_convert('outname.png') % assumes resolution = 125dpi
   print_convert('outname.png','-density 150') % resolution to 150 dpi
   print_convert('outname.png','-density 150', 0.5)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG: eidors progress and status messages</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function print_convert(filename, options, pagehwr)</a>
0002 <span class="comment">% PRINT_CONVERT: print figures and call imagemagick to trim them</span>
0003 <span class="comment">% print_convert(filename, options, pagehwr)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  filename: filename to print to file type is the extension</span>
0006 <span class="comment">%  options:  options to send to imagemagick convert (if it is available)</span>
0007 <span class="comment">%  pagehwr:  set page high/width to control shape of figures</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%  Examples</span>
0010 <span class="comment">%   print_convert('outname.png') % assumes resolution = 125dpi</span>
0011 <span class="comment">%   print_convert('outname.png','-density 150') % resolution to 150 dpi</span>
0012 <span class="comment">%   print_convert('outname.png','-density 150', 0.5)</span>
0013 
0014 <span class="comment">% (C) Andy Adler 2010. License: GPL v2 or v3. $Id$</span>
0015 
0016 <span class="keyword">if</span> nargin&lt;=1; options = <span class="string">''</span>;  <span class="keyword">end</span>
0017 <span class="keyword">if</span> nargin&lt;=2; pagehwr = 6/8; <span class="keyword">end</span>
0018 
0019 <span class="comment">% Test if we have imagemagick convert</span>
0020 [ret1,ret2] =system(<span class="string">'convert -version'</span>);
0021 <span class="keyword">if</span> ret1 == 1 || ~any(findstr(ret2, <span class="string">'ImageMagick'</span>))
0022    <a href="../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>([<span class="string">'This function requires the ImageMagick convert program '</span> <span class="keyword">...</span>
0023                <span class="string">' be installed and on the path.'</span> <span class="keyword">...</span>
0024                <span class="string">' On windows, we recommend you install it as part of '</span> <span class="keyword">...</span>
0025                <span class="string">' cygwin (www.cygwin.com)'</span>]);
0026    <span class="keyword">return</span>
0027 <span class="keyword">end</span>
0028 
0029 tmpnam = [tempname,<span class="string">'.eps'</span>];
0030 
0031 posn = get(gcf,<span class="string">'PaperPosition'</span>);
0032 <span class="comment">% I wish matlab gave us unwind protect - like octave does!</span>
0033 set(gcf,<span class="string">'PaperPosition'</span>,[posn(1:3), posn(3)*pagehwr]);
0034 print(<span class="string">'-depsc2'</span>,tmpnam);
0035 set(gcf,<span class="string">'PaperPosition'</span>,[posn(1:4)]);
0036 
0037 <span class="comment">% Fix cygwin bugs</span>
0038 slash = find(tmpnam==<span class="string">'\'</span>);
0039 <span class="keyword">if</span> any(slash)
0040    tmpnam(slash) = <span class="string">'/'</span>; <span class="comment">% Works for all oses</span>
0041 <span class="comment">%  tmpnam = ['/cygdrive/', tmpnam([1,3:end])]; - find a way to generalize</span>
0042 <span class="keyword">end</span>
0043 
0044 ld = <span class="string">''</span>; <span class="comment">% OVERRIDE STUPID MATLAB LD_LIBRARY_PATH</span>
0045 <span class="keyword">if</span> isunix &amp;&amp; ~exist(<span class="string">'OCTAVE_VERSION'</span>,<span class="string">'var'</span>);
0046    ld= <span class="string">'LD_LIBRARY_PATH=&quot;&quot;'</span>;
0047 <span class="keyword">end</span>
0048 
0049 <span class="comment">% this isn't working for old versions of vnc</span>
0050 cmd = sprintf(<span class="string">'%s convert -density 125 %s -trim  %s %s'</span>, ld, options, tmpnam, filename);
0051 
0052 <span class="comment">% Code to try to use gs to get around imagemagick bugs</span>
0053 <span class="keyword">if</span> 0
0054 options = regexprep(options, <span class="string">'\-density (\d+)'</span>,<span class="string">'-r$1'</span>);
0055 cmd = sprintf(<span class="string">'%s gs -r125 %s -dEPSCrop -sDEVICE=png16m -sOutputFile=%s -dBATCH -dNOPAUSE %s'</span>, <span class="keyword">...</span>
0056     ld, options, filename, tmpnam) 
0057 <span class="keyword">end</span>
0058 
0059 flag = system(cmd);
0060 <span class="keyword">if</span> flag~=0
0061    warning(<span class="string">'Failed to call imagemagick to crop image?'</span>);
0062 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 13-Jul-2011 23:23:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>