Plan for 3.12:
 - img_point_mapper that works in Octave
Plan for 3.11
 - Failing tests:
   + [GREIT3D_distribution: => Fix to use weight rather than NF
ERROR = (Error using eidors_default>get_default (line 106)
   + emphasize_electrode_text => Fixed direction via view
   + fwd_model_1st_order => Check ground node warning
   + calc_slices => fix unit_test to have clean use of tol
 + fix direction in emphasize_electrode_text
 - Add 3D for prior_gaussian_HPF
 - Test why fwd solver not more efficient with large stim patterns
 - Fix prior_gaussian_HPF: not yet able to generate 3D models
 - Make sparse overload smarter
 - New included data based on the JXBrunner data set
 + Fix print_convert to deal with PaperPositionMode behaviour change 
 - Warn if GREIT3D_distribution has zvec outside image and opt.distr = []
 + Use oncleanup https://www.mathworks.com/help/matlab/ref/oncleanup.html
 - mk_grid_model => Warn if length(vector)==1
 - debug "Interpolation failed for point ..." in mk_c2f_circ_mapping
 - Fix phase delay in meas_pattern
 - Speed up / clean up _higher_order code
 - Fix _higher_order to handle faces-type electrodes
 - Remove "This is an EIDORS bug" test in ng_mk_fwd_model.m:58 after validating
 - DONE (calc_grid_points) new function: calc_volumes which calculates elems => volumes or nodes => volumes
 - DONE(img_point_mapper) new function low level: interp_points(img, xyz_points) use point_in_tet 
 - support c2f in img_point_mapper (Bartek)
 + refactor the point_to_tet part of mk_tet_c2f
 + Check line and comment mk_tet_c2f: 429  rnode2tet = sparse(rnode2tet);
 - test netgen 6.2 for linux and windows
 + DON'T include netgen 6.2. KEEP OLD since smaller and don't need python
 - fix print_convert - accept command line option for pagesize (-p10x20, -pAuto)
 + fix print_convert - put stuff on clipboard in windows
 + fix print_convert for new matlab versions. Figure out when distorted image
 - bugs in ng_mk_geometric models? (tutorial #30)

 + Refactor fmdl.mdl_slice_mesher.level.rotate/centre
	- central function to handle levels:
		- scalar
		- 1 x 3
		- N x 3
		- struct('rotate','center', 'n')
	- affected functions:
		calc_slices
		+ mdl_slice_mapper
		+ mdl_slice_mesher
		show_slices
		show_slices_move
		show_3d_slices
		show_current
		mk_pixel_slice
		calc_image_SNR - assumes level is a 3 element vector, difficult
 - merge meshes speed-up/refactor (Bartek)
 

Plan for 3.10
 - fix direction in emphasize_electrode_text
 + Add internal nodes functions
 + Add direct control of electrode surf
     + update remove_unused_nodes
 + remove mat_idx_reordered
 - rebuild netgen_cyl_models20.png
 - make show_3d_slices work with *node_data
 + in ng* files, make all %f to be full precision
 - verify ng* can take multiple parameters
 - fix documentation for ng_mk_closed_contour
 + add time-filter function
 + cache to disk
 + add contour image function => added to show_slices
 - fix bugs from the mailing list
 + test eidors can handle two-digit verion 3.10beta1
 + update default colour
 - matlab 2019a has problems with eidors_var_id (sometimes)
    - try to figure out when
 - eidors_var_id is not reliable under octave (win+linux)
    (parts of it work)
 - add new animal models

Defer (after 3.9.10)
 - GREIT3D doesn't work for non-extruded shapes (see apr 2019 email discussion)
 - expose topandbot for most ng* files (not sure this is useful)
   - ng_mk_cyl_models.m
   - ng_mk_ellip_models.m
   - ng_mk_extruded_model.m
 - write tests and fix ng_mk_geometric_models (bug line 1401 doesn't generate volumes)
 - calc_slices given un unbalanced image in the centre for odd npoints.
 - Fix failing unit test in system_mat_fields => why are internal nodes doubled?


Modifications post 3.9.1
 - Add test for print_convert for gcf/pp.figno
 - Add test for stim_meas_list using vector current
 - Fix bug in ng_mk_extruded_model with 3D electrode positions.

 - Complete modifications started in ng_mk_geometric_models
    - Complete code for maxh
    - Better handling of temp variables
 - Clean up caching in mk_grid_c2f (don't cache three times)
===========================
 - Fix bug in calc_hm_set - use with 3D arrays

 - Fix prior_gaussian_HPF to accept 3D models

 - the code in cg_ards_recruitment_ zip files have many issues
     - use deprecated gaussian_hpf_prior
     - needs filter toolboxes

 - continue automatic manage renumbering/renaming of electrodes (started).

 - add ability measure currents (ie with voltage drive)

 - For mk_c2f_circ_mapping find a way to correct cylindrical maps

 - allow solving on the image with multiple elements

 - Consider letting show_3d_slices show 2D slices if supplied

##### RELEASE 3.9.1 ITEMS
 + CEM will not get added for electrode defined on internal nodes.
     Corrected code to be added to system_mat_fields
     Ensure electrode goes in both directions
     OR: have a way to break and join models
     (specify that nodes get joined)

 + Consider letting show_3d_slices show 2D slices if supplied

##### POST RELEASE 3.9 ITEMS
 + debug calc_R_prior UNIT_TEST (ichol doesn't give a good estimate, also not posdef)
    
 + lookfor fminsearch_octave and see if current version still needs it.

 + mk_c2f_circ_mapping doesn't give very accurate results
     even when a large n_interp_min value is given
    - see test code from 19jan2017 (AA)

     

 + Add ability to do voltage drive.
 
 + automatic manage renumbering/renaming of electrodes (started).

 + ng_mk_geometric_models give lots of warnings

 + ng_mk_ellip_models still sorts mat_idx => fix 
    => Output parameter mat_idx is not the real mat_idx

##### POST RELEASE 3.8 ITEMS

 - make per function eidors_msg verbosity levels

 - Make greater use of eidors/models/valid_{img,fwd_model,inv_model,data}
   for checking consistency of the key EIDORS data structures and
   preventing the need to support odd data structure constructions.
    - Tighten checks where appropriate?
    - Add further "common typos" illegal fields.
    - Refactor checking code.
    - Add check for "inv_model requires fwd & rec_model", see below TODO.
   Add checking to:
    - mk_common_models, other model generators (output)
    - inv_solve (input and output)
    - fwd_solve (input and output)
      - fwd_solve checking off by default, enabled for unit testing? this
        might be a speed hit for iterative inv_solve where many fwd_solves
        are required
    - elsewhere?

 - Efficiency of calculations with multiple RHS
    - look at dev/a_adler/testcode/qr_efficiency.m
    - in left_divide, time via: t1=cputime; V= (E \ Q)*R; t1=cputime-t1;
    - in left_divide => Q/R should be cached

 - Caching efficiency improvements
    - cache small objects (like NF / hyperparameter tables)
    - think about how to achieve boost_priority for big ng_models

 - remove np fields from ng_mk_models
    - add default np fields to the np functions

 - the whole time_solver infrastructure needds to be properly tested

 - centralize colourmap handing in eidors
    - move colourmap adding from show_fem_enhanced (hg's code)
    - add ability to set various background colour (cg's code)
    - move to using matlab's colourbar if possible
    - eidors_colourbar should know how many fake colours we have
 - in calc_RtR_prior there's some pretty incorrect c2f handling

    - Is there any way to avoid "fake colours". These make it ugly
        when people use standard matlab functions for images.

 - remove mat_idx_reordered

 - code in choose_noise_figure is hard to understand.
       Why search1,2 etc? Why not bisection search?
    - Debug and change or add comments

 + show_fem_enhanced - handle resistors (tutorial020a)

 - force all inv_model to have fwd_model and rec_model
    - rewrite prior code to assume rec_model is available.

 - On left_divide
    - remove old parameters tol,pp,V)
    - add options for solver type, tol, etc

 - Merge Hex mesh code from dev/l_selvakumaran

 - Make analytic c2f the default
    - think of better tests

 - Colourmap managing
    - experimental image_field in calc_colours (see cg_ards_recruitment_04)
    - cmap_type = 'draeger' does draeger colours, but not the offset
        in the colourbar. Add a centre_move option to eidors_colourbar
    - show_fem_enhanced does own stuff with colours

 + check that latest octave has fminsearch and remove switch from mk_GREIT_model line 139

 - Mods to show_slices to only show part of the slice

 - Test if Problems with HPF_Gaussian prior?

 - in scale_for_disply, calculate ref_lev weighted by element size (if avail)

- verify that elec_frac = [k ... in mk_grid_model creates conformal grid --??

- put warning in mdl_slice_mesher when level doesn't cut the model
    (currently this gives error: consider at line 110 when els = [])

 - tutorials

################# EIDORS 3.8 RELEASE PLANNING ################

LAST MINUTE
  + new abs solve
  + Draeger data loader
  + swisstom LQ4 format
  + test analytic c2f
     mk_tet_c2f
     mk_grid_c2f
  + unit tests
  + tutorial tests
  + add data 
     - if_peep_ALI => too big
     + if_neonate_spontaneous
     - ards p1     => too big

HIGH PRIORITY

 + mex compilation problems on windors

 + netgen 5.3+ support (also 4.9.13 with ubuntu)

 + Physics => Parameters
    - ensure jacobian_perturb works on physics parameters
    - plan
       - maybe remove all commits and restructure to ensure understanding
       

 + fwd_model.electrode(:).z_contact
    + discuss change of name (surface impedance rather than contact impedance)
      and units with interested parties
    + z_contact units were changed from Ohm/m^2 (Ohm/m in 2d) to Ohm at SVN rev
      4301 in eidors/solvers/forward/system_mat_fields.m where the z_contact
      was distributed based on area and is now percentage of area so that a
      change in electrode diameter does not affect the total impedance through
      the electrode.
    + rename z_contact to z_surface(?) and give warning if z_contact is used.
       (not done)

 + Use Herve's NG interface as the default
      (postponed)

 + C2F FIXES
    - tet2tet c2f
    - test: Laplace prior with a 3D-2D grid setup gives pepper noise with prior_use_fwd_not_rec=1;
    - clean up the whole c2f and parameter_mapping 
       - fix tutorials
       - handle complex non-linear parameter maps
    - c2f - think about how to work on NOSER -AA
       - what if we send fwd to the prior calculation?
             (img.orig_fwd_model)
          - provide some new options for abs solvers
      - add a parameter_mapping interface
    - check c2f processing in show_3d_slices

 + colourbar - put some logic to allow labels like 1.5 as max
    (instead of 1,2,3 etc)
    + when max is 1.5 (or 3) then split into 1,2,3, not 1.5,3
    + test it with the new matlab

 + test with new matlab
    + does unique work

LOWER PRIORITY
 + speed up linear_reorder
 + caching in fix_model

 + all inverse solvers to do print data residual
     + default not calc residual

 + animate stimulation patterns: display_meas (and rename)

 + bug in prior_covar UNIT_TEST


 + check for additional y-cut in show_3d_slices

 + ng models with point electrodes (in 3D - check Herve's code)

 - experimental image_field in calc_colours (see cg_ards_recruitment_04)

 + eidors_msg is too verbose. Example is: eidors_cache.m/cache_shorthand

 - check that latest octave has fminsearch and remove switch from mk_GREIT_model line 139

 - cmap_type = 'draeger' does draeger colours, but not the offset
     in the colourbar. Add a centre_move option to eidors_colourbar

 - Mods to show_slices to only show part of the slice

 + Bug with 'trig' measurement patterns
    + make an option to give the stim pattern used by RPI

 + Nodal Jacobian bugs (example in 24 jan 2012 email)
   => Unable to locate

 - Test if Problems with HPF_Gaussian prior?

 + print_convert => remove old info in help

 - Deprecate jacobian.background.value ->
 -            jacobian.background.elem_data (and new physics)

 + clean up TODO in inv_solve_abs_GN
    (specifically the coarse2fine handling
      + cover whole region, etc)

- in scale_for_disply, calculate ref_lev weighted by element size (if avail)

+ function inv_solve_abs_GN, hp2RtR= hp*RtR. Should be hp squared

+ I have a suggestion regarding the default values in the function
     “mk_GREIT_model.m”. In line 349 “opt” is checked for the field
   “noise_figure”. If it doesn’t exist, it is set as empty. However, in this
   case the parameter “weight” must be set and must not be left empty. Otherwise
   the call of “calc_GREIT_RM” will result in an error stating “not coded yet”
   (line 50 in calc_GREIT_RM.m), since weight will not be specified (line 117 in
   mk_GREIT_model.m). This error does not represent the real problem as it is
   supposed handle non scalar “weight” parameter. In my case, it took some time
   until I understood my real fault.
   My suggestion is: In the “parse_options”-function: Check if both
   opt.noise_figure AND weight are empty / non existing. If so, set
   opt.noise_figure to the recommended level of NF=0.5. Peronally, I don’t have
   a feeling for an appropriate NF, so a default value would help. In addition,
   currently the error pops out after the call of “stim_targets”, so that it
   takes a lot of time, until the call fails. Alternatively, the description of
   the weight parameter could be changed to:
   “weight - weighting matrix (weighting of noise vs signal). If empty,
   options.noise_figure MUST be specified”

 
+ add num_elecs.m function
+ bug in ng_mk_gen_models with top/bottom square elecs
    shape_str = ['solid top    = plane(0,0,  0;0,0, 1);\n' ...
                 'solid bot    = plane(0,0,-10;0,0,-1);\n' ...
                 'solid ob     = orthobrick(-3,-3,-99;3,3, 99);\n' ...
                 'solid mainobj= top and bot and ob -maxh=0.5;\n'];
    elec_pos = [ 0,0,0, 0,0,1;0,0,-10,0,0,-1];
    elec_shape=[0.2,0.2,0.05]; elec_obj = {'top','bot'};
    fmdl = ng_mk_gen_models(shape_str, elec_pos, elec_shape, elec_obj);
     => Fix is a hack; electrodes never really make for vertical
     => should move to Herve's new interface

+ make inv_model.inv_solve.calc_solution_error = 0
  default. Or fix for large solutions.

- verify that elec_frac = [k ... in mk_grid_model creates conformal grid --??

- put warning in mdl_slice_mesher when level doesn't cut the model
    (currently this gives error: consider at line 110 when els = [])

+ fix mk_image so that it can handle a time series image

+ Update Draeger file reader software.



TUTORIALS
 - fix the example tutorial
        EIDORS_basics/example_abs_GN_compare_3D.m

 - fix colours tutorials eidors3d.sf.net/tutorial/data_structures/eidors_colours.shtml

 - fix simulate_move2_ ... tutorials to use 2d netgen interface

 - replace tutorial 151 with better absolute solver example

 - fix jacobian_elem2nodes
    - test behaviour for simple elec sensitivity models

 - tutorial on mk_image including nodal images

 - Add a tutorial to show how to do pairs of electrodes
    for injection patterns

 - update GREIT tutorials to give recommendations to make it pretty
    - make new GREIT tutorial
    - do this as part of a paper
    - Make sure default GREIT is pretty

 - create tutorial for  place_elec_on_surf


DEFER TO 3.9

 - create test infrastructure for old tutorials


 - Full OEIT v1.1 support

 - redo dm_distmeshxx - base it on dm_2d_pt_elecs
 - update distesh to latest version
 - fix and re-insert dm_geophys into tutorials

#################
- in scale_for_disply, calculate ref_lev weighted by element size (if avail)

- function inv_solve_abs_GN, hp2RtR= hp*RtR. Should be hp squared

- I have a suggestion regarding the default values in the function
     “mk_GREIT_model.m”. In line 349 “opt” is checked for the field
   “noise_figure”. If it doesn’t exist, it is set as empty. However, in this
   case the parameter “weight” must be set and must not be left empty. Otherwise
   the call of “calc_GREIT_RM” will result in an error stating “not coded yet”
   (line 50 in calc_GREIT_RM.m), since weight will not be specified (line 117 in
   mk_GREIT_model.m). This error does not represent the real problem as it is
   supposed handle non scalar “weight” parameter. In my case, it took some time
   until I understood my real fault.

   My suggestion is: In the “parse_options”-function: Check if both
   opt.noise_figure AND weight are empty / non existing. If so, set
   opt.noise_figure to the recommended level of NF=0.5. Peronally, I don’t have
   a feeling for an appropriate NF, so a default value would help. In addition,
   currently the error pops out after the call of “stim_targets”, so that it
   takes a lot of time, until the call fails. Alternatively, the description of
   the weight parameter could be changed to:

   “weight - weighting matrix (weighting of noise vs signal). If empty,
   options.noise_figure MUST be specified”

 

- add num_elecs.m function
- bug in ng_mk_gen_models with top/bottom square elecs
    shape_str = ['solid top    = plane(0,0,  0;0,0, 1);\n' ...
                 'solid bot    = plane(0,0,-10;0,0,-1);\n' ...
                 'solid ob     = orthobrick(-3,-3,-99;3,3, 99);\n' ...
                 'solid mainobj= top and bot and ob -maxh=0.5;\n'];
    elec_pos = [ 0,0,0, 0,0,1;0,0,-10,0,0,-1];
    elec_shape=[0.2,0.2,0.05]; elec_obj = {'top','bot'};
    fmdl = ng_mk_gen_models(shape_str, elec_pos, elec_shape, elec_obj);

- make inv_model.inv_solve.calc_solution_error = 0
  default. Or fix for large solutions.

- verify that elec_frac = [k ... in mk_grid_model creates conformal grid

- check c2f processing in show_3d_slices

- put warning in mdl_slice_mesher when level doesn't cut the model
    (currently this gives error: consider at line 110 when els = [])

- fix mk_image so that it can handle a time series image

- Netgen has problems for ver>5.0. Why?

- Update Draeger file reader software.

############## April 27-29, 2014 Work ##############
- provide a helper function so that you can save and restore the state of
  eidors_cache enable/disable for functions -- this will allow functions to
  manipulate the cache prior to operations and safely restore state before
  returning control

- abs_solver_GN with physics

+ rename physics -> parametrizations (params)

- rename imdl.parameters in inv_solve to imdl.opt (controls for inverse solver)

- coarse2find and parameterization
   - understand problems
   - z direction

- show_slices planes bug

- fix cache in windows

- sparse matrix inefficiency
   - from Nov 2013 mailing list
   - need:   ans = lhs(:,idx)*rhs(idx,:);  % SELECT WITH IDX

- probably set default imdl.inv_solve.calc_solution_error = 0;

- should eidors do introspection and ask solvers if they are absolute or diff?
   - should we get rid of imdl.reconst_type (replace by introspection)?


- auto compilation of mex doesn't work on linux with mv problems

- think about function specific verbose?

- Data pathway
  - INPUT: data (unit1 (example voltage))
  => converted to working data (unit2 (example apparent_resistivity))
  - START: initial image (unit3 (example log_conductivity))  
     (note, problems setting this, mk_image and c2f)
  => NEED: translate to forward_solve units
  => NEED: translate to calc_jacobian units
  => NEED: elem_output (unit4 final tranlation of units)
  - NOTE (can have multiple parameters with different units)

 - Why doesn't the qr in forward_solve speed up the jacobian calc

############## 3.8 ################

 - experimental image_field in calc_colours (see cg_ards_recruitment_04)

 - eidors_msg is too verbose. Example is: eidors_cache.m/cache_shorthand

 - eidors_msg needs to be able to control verbosity based on which function it
   is currently printing from; "help" claims this feature exists but doesn't
   seem to work in practice
   >> help eidors_msg
     EIDORS_MSG('log_level', LVL, FNAME) sets a custom log_level for m-file
   --> once per file log_level is working, inv_solve_abs_core and
       line_search_onm2 need to be updated (AB)

 - test_3d_resistor:
   - make test_3d_resistor a function
   - add UNIT_TEST and use unit_test_cmp(), see test_2d_resistor
   - check that it is calculating z_contact correctly for analytic solution
     (missing X/scale^2 term?)

 - Fix test_2d_resistor, test_3d_resistor warnings:
   "Warning: Calling CALC_SYSTEM_MAT with two arguments"

 - fwd_model.electrode(:).z_contact
   Discuss change of name and units with interested parties.

 - mex compilation problems on windors

 - netgen 5.1 doesn't appear to support batchmode

 - check that latest octave has fminsearch and remove switch from mk_GREIT_model line 139
 - Sparse matrix efficiency. Is there a way to 
    generalize the idx operations now in fwd_model_1st_order?

 - Full OEIT v1.1 support

 - Check caching efficiency and timing bugs

 - Laplace prior with a 3D-2D grid setup gives pepper noise with prior_use_fwd_not_rec=1;

 - ng models with point electrodes
   + fixed for 2D

 + fixed calc_colours to work for mapped_colour = 0

 - check for additional y-cut in show_3d_slices

 - remove np fields from ng_mk_models
    - add default np fields to the np functions

 - redo dm_distmeshxx - base it on dm_2d_pt_elecs
 - update distesh to latest version
 - fix and re-insert dm_geophys into tutorials

 - ensure jacobian_perturb works on physics parameters

 - colourbar - put some logic to allow labels like 1.5 as max
    (instead of 1,2,3 etc)
    - when max is 1.5 (or 3) then split into 1,2,3, not 1.5,3

 - fix the example tutorial
        EIDORS_basics/example_abs_GN_compare_3D.m

 - cmap_type = 'draeger' does draeger colours, but not the offset
     in the colourbar. Add a centre_move option to eidors_colourbar
 - fix colours tutorials eidors3d.sf.net/tutorial/data_structures/eidors_colours.shtml

 - fix simulate_move2_ ... tutorials to use 2d netgen interface

 - replace tutorial 151 with better absolute solver example

 - Bug with 'trig' measurement patterns
    - make an option to give the stim pattern used by RPI

 - Nodal Jacobian bugs (example in 24 jan 2012 email)

 + fix tutrorial for human thorax - ensure it works

 - fix jacobian_elem2nodes
    - test behaviour for simple elec sensitivity models

 - tutorial on mk_image including nodal images

 - update GREIT tutorials to give recommendations to make it pretty
    - make new GREIT tutorial
    - do this as part of a paper
    - Make sure default GREIT is pretty

 - Deprecate jacobian.background.value ->
 +            jacobian.background.elem_data (and new physics)

 - clean up TODO in inv_solve_abs_GN
    (specifically the coarse2fine handling
      - cover whole region, etc)

 - clean up the whole c2f and parameter_mapping 
    - fix tutorials
    - handle complex non-linear parameter maps

 - create tutorial for  place_elec_on_surf

 - need to completely avoid matlab's colourbar - DEFER to 3.8
    - add more colourbar tutorials, to show background colour features.

 + fix tutorials:
          distmesh/dm_geophys.shtml

 + refactor out the mdl2d_from3d from various ng_mk function - DONE AB 2013-09-18
 + depreciate mat_idx as output variable (store in fmdl) - DONE AB 2013-09-18
 + store netgen mat_idx prior to legacy reordering (fmdl.mat_idx, fmdl.mat_idx_reordered) - DONE AB 2013-09-18

 - Mods to show_slices to only show part of the slice

 - Add a tutorial to show how to do pairs of electrodes
    for injection patterns

 - add option to show_fem to display electrodes that
       come from another model (is the fine model)
     (or create a function to do this)

 - data_contrib - add slow flow inflation (Pulletz 2012) data

 - think about a move to some type of bugzilla version management.

 + fix print_convert

 - Test if Problems with HPF_Gaussian prior?

 = add a code to set_fields into tools (won't do for now)

 - c2f - think about how to work on NOSER -AA
    - what if we send fwd to the prior calculation?
          (img.orig_fwd_model)
       - provide some new options for abs solvers
   - add a parameter_mapping interface

 - force all inv_model to have fwd_model and rec_model
    - rewrite prior code to assume rec_model is available.

 - all inverse solvers to do print data residual

 - animate stimulation patterns: display_meas (and rename)

 - bug in prior_covar UNIT_TEST
     - the whole time_solver infrastructure needds to be properly tested

 - create test infrastructure for old tutorials

 + keep the gmsh path the same way as the new netgen

 - On left_divide
    - remove old parameters tol,pp,V)
    - add options for solver type, tol, etc

############## 3.7.1 ################3
 + how to touch on svn - or delete and readd
 + write the changes
 + update news
 + update version #
 + build docs x 2
 + update README
 + touch mex files to be older than *cpp
 - build script and zip file
 - tag release
 - zip -r -9 eidors-vXX.zip eidors-vXX

 + Update FAQ
     - Netgen build
     - Ubuntu fonts xfonts-75dpi xfonts-100dpi 

 + test_2d_resistor
    + why fwd_solve_1st_order: 249.294837 Solver analytic: 249.745561
    + put into a proper test function as UNIT_TEST

 + print_convert - all matlab version
    + test for imagemagick, have code to use it - not needed any more
    + top and right of image are cropped by 1 pixel -AA

 + allow netgen paths with spaces in windows

 + Fix spaces in path bug with windows netgen

 + review images

 + stl support

 + code from BMU
 
 - fix distmesh 


############## 3.7 ################3
 + fix set_field in physics data mapper

 + fix startup isues on windows

 + change background colour

 + add tmp file handling to ng_mk_2d_model

 + revert changes to .cpp file OR recompile all mex files
    + solve by touching *mex files before release

 + octave tests

 + Windows errors

 + fix call_netgen
   + call_netgen create a user writable dir

3.7 RC
 + check and commit images for stimPatt_PseudoSec -NL

 + fix ugly tutorials

 + Make sure default GREIT is pretty -BG
    = add string interface

 + dm_geophys03 - ugly images -AA

 + make mk_GREIT_model accept function for desired image

 + tutorial_tests errors
     + (WFM?) framework05 
     + tutorial210d - physics error
     + stimPatt_PseudoSec02 ERROR = (Error using show_pseudosection
     + cg_ards_recruitment_00 ERROR = (Error using checkfilename>validateFilename (line 182)
     + thoraxmdl02 - ng_remove_electrodes 
     + (WFM?) thoraxmdl03 - mdl_normalize
     + eidors_toast_demo1 - toastMakeMesh - Add documentation

 + rerun GREITv1 performance metrics with new GREIT cylinder

 + fix and test:  EIDORS_basics/example_abs_GN_compare_3D.m

 + debug caching for netgen models
    + example is show_pseudosection UNIT_TEST
    + write function to give messages when cache happens

 + output svn verions

 + check and commit images for thoraxmdl   

 + fix calc_colours to it takes non 256 colours (in CG's code) and 

 + ng on windows (incl ng.opt interface) - test ng5


 + in show_pseudosection
     - fmdl.show_pseudosection.orientation = field

 + set properties properly

 + mk_image to create node_data - BG

 + new physics -BG
    + docs for mk_image
    + accessor functions for elem_data (and new physics)
 
 + fix anisotropy -> show_fem to display check -AA

 + colorbar -BG(start)
    + code in move_2d02 and eidors_colourbar - DONE
        + need to have option to put colorbar outside 
    + check every use of cb_shrink_move in tutorials 
     +  adv_image_reconst/move_2d02.m
     +  data_structures/eidors_colours02.m
     +  data_structures/eidors_colours03.m
     +  data_structures/eidors_colours04.m
     +  data_structures/eidors_colours05.m
     +  data_structures/eidors_colours06.m
     +  data_structures/eidors_colours07.m
     +  EIDORS_basics/basic_3d_02.m
     +  EIDORS_basics/example_abs_GN_compare_3D.m
     +  EIDORS_basics/forward_solvers01.m
     +  EIDORS_basics/forward_solvers02.m
     +  EIDORS_basics/forward_solvers03.m
     +  EIDORS_basics/forward_solvers04.m
     +  EIDORS_basics/forward_solvers_2d_high_order02.m
     +  EIDORS_basics/forward_solvers_2d_high_order02.m
     +  EIDORS_basics/rpi_data02b.m
     +  EIDORS_basics/rpi_data03.m
     +  EIDORS_basics/rpi_data04.m
     +  EIDORS_basics/rpi_data05.m
     +  EIDORS_basics/rpi_data06.m
     +  EIDORS_basics/sensitivity_map01.m
     +  netgen/netgen_sims02.m

 + test new png on windows

ANNOUNCE:
 - new phyics
 - anisotropy for fwd_model
 - opt file

########### DONE FOR 3.7 ############
 + fix and restore warning state EIDORS:DeprecatedInterface

 + calc_meas_icov -> choose good value for normalized solvers - DONE
     - why is is homg^2 rather than inv(homg)^2 - tested
     - maybe just abs(homg) is better and less sensitive

 + fix calc_jacobian_test - DONE
     -> line 108

 + move place_elec_on_surf into main

 + pixel grid interface function

 + Create helper function spdiag

 + Make functions - WON'T DO
     mk_fwd_model
     mk_inv_model
   that do useful stuff like
     normalize_measurements = 0;

 + calc_meas_icov -> choose good value for normalized solvers
     - why is is homg^2 rather than inv(homg)^2
     - maybe just abs(homg) is better and less sensitive
     - fix calc_jacobian_test


################################ HISTORY ######################
+ mk_image assumes values on elems. THink about how
    to create node images. New function?
-------------
Lower priority items
3 - colourbar
8 - ng.opt interface
6 - data from
  - patient 7 - DONE
  - dargaville (2010) - DONE
  - Slow flow inflation (Pulletz 2012)
4 - GREIT electrode errors - DONE
3 - Bill's analytic c2f mapper
9 - 2D Netgen + elecs
9 - Automate c2f and include parameterization options
3 - c2f - extrude options
3 - c2f - extra space options
8 - c2f - using mdl space mapper
9 - netgen interface to keep points
3 - 3D electrode shapes interface 
    (alllow electrode shapes which penetrate object)
9 - refactor ng interface functions (unmix pieces)
7 - Cleanup difference_data, incorporate apparent resistivity
4- fix prior covariance
3 - fix noise covariance
9 - model validation - automatic testing whether model elements are consistent
3- plan next releases
   3.7 (january) 3.8 ? 4.0 ?
9 - infinite elements
6 - hessian


-------------
Plans for Manchester code-a-thon:

1. Geophysics
2. GREIT: target distributions and other defaults, electrode errors
3. Bill's c2f mapper
4. Electrode interface for netgen 2d models
5. place_elec_on_surf
6. move normalize_measurements from fwd_model to inv_model gracefully. Take care of calc_difference_data

----------------
Add option to mk_coarse_fine_mapping to control the direction
in which we do the mapping (default = z)
-----------------
Add mk_stim_wenner and other geophysical patterns
-----------------
Fix the 'mA' in stimulation. This should be 'Amps'
-----------------
- Look at backproj - make sure it has the correct orientation (same as GREIT)
   - AA 20120730
-----------------
- Check correct operation and speed up prior_covar
   - AA 20120730
-----------------
- still bugs in eidors3d_tutorial near line  253: NaNs
[J] = jacobian_3d(I,elec,vtx,simp,gnd_ind,mat_ref,zc,v_f,dfj,tol,'{n}');

-----------------NEW
 - calc_jacobian_test fails
-----------------
 - think through the fwd_model.background - good idea?
-----------------
 - Movement priors, allow selection of dimensions
-----------------
 - turn 4d solver into a prior
  - build a 4d tutorial using simulate_3d_movement and
         tutorial/dual_model/centre_slice.shtml
-----------------
 - fix GN_first order to do Wiener form
  = modify priors to give R and inv(R) as requested
-----------------
 - Create a "contributions" section
   - move part of the tutorials into the contribs
-----------------
 - Build NG.bat file into the path.
    - maybe have eidors/executables?
    - maybe an eidors install script
-----------------
 - Move away from assuming default n_elec is 16 in mk_common_model
-----------------
PRI DEF=
1 do now
2 do next
3 hope into release
4 if we have time
5 some day

###############

========== 01: PRI=1 ACT=AA
tutorials - deprecate update
 - geophys tutorial - finish = AA
 - add neonate tutorial
 - look at tutorial report
========== 03: PRI=1 ACT=AA
 complex conductivity
========== 04: PRI=1 ACT=MC
check jacobian c2f calcs
 - see if we need bs_calc_system_mat
 - look at background parameter
========== 05: PRI=1 ACT=AA
inv_solve_4d_prior and inv_solve_time_prior ?
Add Wiener filter form to speed up
========== 09: PRI=1 ACT=BG/AA
 - fix eidors colorbar - give proper location
Fix colourbar -> make work with Camille's code, too.
 - BG's colourbar
========== 13: PRI=2 ACT=AA/BG
noise figures and nf selection code
========== 14: PRI=2 ACT=MC/RM
c2f - analytical
 - mk_c2f_circ_mapping - not quite right fitting
========== 15: PRI=2 ACT=BG
GREIT: movement + noise weighting
========== 16: PRI=2 ACT=AA
fix timing in eidors_var_id
========== 18: PRI=2 ACT=AA
whole electrode options for ng_mk_gen...
========== 19: PRI=2 ACT=AA
Fix coarse2fine -> give options for elements in fine but not coarse model
========== 20: PRI=2 ACT=?
write a non-linear GN solver
  - consider bs_nonlinearGN
  - move absolute tutorials into functions in main code
========== 22: PRI=2 ACT=?
Cleanup calc_colours to clean up handling of image_field parameter.
  - code also in eidors_colours, scale_for_display, 
  - probably need new colourbar functions
========== 24: PRI=2 ACT=AA
 - reorganize tutorials
 - PLAN => AA create a "papers" section of htdocs => click on paper => tutorials
========== 25: PRI=2 ACT=?
 - think through mk_common_model, library_model, and choose_imdl
    - what to deprecate, how to merge
 - library_model => accept simulation
========== 26: PRI=3 ACT=?
CG's code
========== 27: PRI=3 ACT=?
think through how the cache is managed. esp for read-only installs
  - look at cache priorities
  - cache to disk
========== 28: PRI=3 ACT=?
parfor
  - is in octave
  - starts in 7.5
  - different behaviour before
http://www.kxcad.net/cae_MATLAB/toolbox/distcomp/bq__cs7-1.html
========== 29: PRI=3 ACT=?
Iteratively refine 
% See also:
% http://www.cs.berkeley.edu/~wkahan/MxMulEps.pdf
% especially page 15 where it discusses the value of iterative refinement
%  without extra precision bits.  ALso, we need to enable 
% system_dependent('SetPrecision', 53) in starup
 - \ => left_divide
========== 30: PRI=3 ACT=?
  - talk to Bill about estimates of covariance inverses 
  - look at calc_Ji ... fcn
========== 32: PRI=3 ACT=?
 - add_noise - work for matrix noise
             - then update temporal_solver01
========== 33: PRI=3 ACT=?
 - merge choose_imdl with select_imdl
 - update select_imdl to reflect best practice
========== 34: PRI=3 ACT=?
 - ng_mk_closed_contour - rename + make tutorial
========== 35: PRI=4 ACT=?
 - unify the 'extra' code handing in ng_mk ...
========== 36: PRI=3 ACT=?
 - see if we need examples, or move to tutorials
    - deprecate demo_real, demo_complex
========== 36: PRI=3 ACT=?
 - add a 'papers using eidors' section
========== 3 : PRI=3 ACT=?
 - 2.5D solutions
========== 37: PRI=4 ACT=?
 OCTAVE DIRECTORY NAMES
   - move to something like x86_64-linux etc
   - get new code into startup which detects the system
   - compile mex file for various oses
========== 38: PRI=4 ACT=?
 - Factor out all the electrode code in the ng_mk* functions
     and put it into a ng_define_electrodes function 
 - Next, create a fourth parameter to control the depth of the electrode shape
========== 39: PRI=4 ACT=AA
 - fix gaussian_HPF_prior
     - work in 3D like laplace_image_prior
========== 40: PRI=4 ACT=?
ng_mk_ ... models
  - put in unit test code
  - allow each to call with multiple extra parameters
  - start to refactor electrode code
========== 41: PRI=4 ACT=?
add interface to ng.opt
========== 49: PRI=? ACT=?
Rename nodal_solve
   => TODO: rename to inv_solve_diff_GN_one_step_nodal;
################ DEFER #####################
Re-think calc_colours: image_fields and
         eidors_colourbar: background (CG's tutorial)

==========
 - deform_cylinder - use proper fit like a fourier fit.
  => keep for historical reasons
========== 42: PRI=? ACT=?
decide if mapping_function should go on fwd_model or img
  => FUTURE
========== 43: PRI=? ACT=?
one important feature would be to add code introspection.
This would allow you to know if a given algorithm can support
   linear reconstruction, etc.

One way to enfore this is to add modes to every piece of code
   function('UNIT_TEST')
   function('CAPABILITY_LIST')
etc.
 => WON'T DO FOR NOW. DEFER FOR LATER

###################### DONE ####################

========== 31: PRI=3 ACT=?
merge eidors_model_params and fix_model
    => DONE. Deprecated eidors_model_params
 -  rename fix_model

 -  merge fwd_model_params
    => Decided against
 - put neighborhood matrix - from M.Crabb
    => DONE. edge2elem, elem2edge, node2elem

========== 00: PRI=1 ACT=AA
 - fix for deprecate
     mk_common_model('n3r2')
    - DONE
========== 10: PRI=1 ACT=MC/RM
noser_image_prior
  - may fail on this line (change in spdiags in new matlab)
    Reg = spdiags( diag_col.^exponent, 0, l_prior, l_prior);
  => DONE. DON'T SEE THE PROBLEM
========== 12: PRI=1 ACT=AA
also show_slices is crufty
% TODO: because we wanted (back in 2005) to let show_slices
% handle lots of different scenarios (calling with images and
% without. It is now crufty ... and should be changed.
  => DONE. VALIDATE WITH TUTORIALS
  => REMOVE CRUFT
========== 07: PRI=1 ACT=BG
 - unit_test_cmp - print tolerance of comparison
 - create assertions. standardize output
  => DONE
========== 11: PRI=1 ACT=AA/BG
There is an inconsistency between
   mk_grid_models - which has its own pixels
and
   calc_slices - which does its own interpolation
Generally, this means that the pictures from calc_slices
are even smoother than they should be. 
  => May be fixed. Check
  => DONE. Fixed in calc_slices
========== 08: PRI=1 ACT=BG
 - ng_mk_functions
     - add mat_idx on the output itself : DONE   
========== 06: PRI=1 ACT=AA
Change code that uses iso_f_smooth to use the proper RtR_prior formulation
    - DONE
========== 23: PRI=2 ACT=BG
DEFAULT SOLVER:
   GN_one_step_diff_solve
 - put defaults for functions
    - DONE
========== 02: PRI=1 ACT=BG
GMSH 
 - see if we need object_in_tank_2d
     => turn into tutorial
   => DONE. Cleanup, speedup and move to dev
==========
 - Caching: all to disable caching calls from a specific function
=>DONE
========== 17: PRI=2 ACT=BG
mk_library
  - put additional files for release
=> DONE
==========
Problems with calc_move_jacobian.m - only with 3D models
========== 44: PRI=? ACT=?
 - move np stuff to background. Change aa to the defaults.
  => DONE
========== 45: PRI=? ACT=?
 - Next, test in 3D
    - issue is here: delVm_pert = pp.N2E*(Vc_delta - pp.Vc) / delta; (line 181)
    - PLAN => M.Crabb take a look and then setup call.
 => DONE 
========== 46: PRI=? ACT=?
 - movement jacobians
     - separate code for movement and conductivity
     - calc_move_and_conductivity_jacobian.m 
     - think about how to depricate aa_e_move_jacobian
     - have explicit function that does perturbation jacobian
 - movement priors
     - calc_move_and_conductivity_prior( move_prior_fun, conductivity_prior_fcn)
       - maybe with some defaults for each case
    - PLAN => M.Crabb to create general functions
 => DONE 
========== 47: PRI=? ACT=?
Create a GN_diff_solve function
   => DONE - AA
========== 48: PRI=? ACT=?
Create a variable in eidors_msg that knows if desktop is available
http://www.mathworks.com/matlabcentral/newsreader/view_thread/284363
mf = com.mathworks.mde.desk.MLDesktop.getInstance.getMainFrame; 
   => DONE - AA
========== 50: PRI=? ACT=?
what is mapper_elems_nodes ??
     ./eidors/models/mapper_nodes_elems.m
  => DEPRECATE
========== 51: PRI=? ACT=?
In octave
   run /path/to/startup.m
will just load the function into memory, you need to run it with startup.
How can we make octave actually run the startup file?
  => DONE - AA
========== 52: PRI=? ACT=?
 => DONE
NEW DIRECTORY STRUCTURE:
 ON THE PATH:
   eidors/
     - license, startup

   eidors/models
     - entry level functions for models

   eidors/meshing
   eidors/meshing/distmesh
   eidors/meshing/gmsh
   eidors/meshing/netgen

   eidors/solvers
     - entry level functions for solvers
   eidors/solvers/inverse
   eidors/solvers/forward

   eidors/algorithms
     - functions to process EIT images (eg. find_frc)

   eidors/examples
   eidors/sample_data
     - a small collection of sample data to play with

   eidors/tools
     - unit_tests
     - mesh fixers
     - evaluation programs
     - test if models have standard fields

   eidors/interface
     - read and write file formats
     - interface to other software (ie Toast)

   eidors/graphics
     - general graphics functions
   eidors/graphics/matlab
   eidors/graphics/vtk


LOW LEVEL DIRECTORIES

   eidors/arch
     - architecture specific (ie mex files)
   eidors/arch/octave
   eidors/arch/matlab

   eidors/cache
     - default, but let users choose where to cache

   eidors/deprecated
     - functions named for particular people (aa, np, etc)

 NOT THE PATH:
   eidors/compatibility
     - compatibility for old eidors code. Stuff that has
       was taken out of deprecated. (not for 3.6)

   eidors/tests 
   dev/name
    - place for work before it moves to release
    - here we have individually named directories
   htdocs/ ...

OLD:
   eidors/
   eidors/algorithms
   eidors/algorithms/t_dai
   eidors/algorithms/b_grychtol
   eidors/algorithms/m_crabb
   eidors/algorithms/a_borsic
   eidors/algorithms/d_stephenson
   eidors/algorithms/b_sawicki
   eidors/algorithms/a_adler
   eidors/algorithms/b_lionheart
   eidors/algorithms/b_graham
   eidors/algorithms/c_gomez
   eidors/algorithms/n_polydorides
   eidors/algorithms/m_vauhkonen
   eidors/arch
   eidors/arch/octave
   eidors/arch/octave/x86_64-pc-linux-gnu
   eidors/arch/octave/pc
   eidors/arch/matlab
   eidors/arch/matlab/dll
   eidors/tests
   eidors/sample_data
   eidors/examples
   eidors/tools
   eidors/meshing
   eidors/meshing/distmesh
   eidors/meshing/gmsh
   eidors/meshing/netgen
   eidors/models
   eidors/models/cache
   eidors/models/s_murphy
   eidors/models/b_grychtol
   eidors/models/d_stephenson
   eidors/models/a_adler
   eidors/models/m_vauhkonen
   eidors/graphics_matlab
   eidors/interface
   eidors/graphics_vtk
