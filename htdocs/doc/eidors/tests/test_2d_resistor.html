<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_2d_resistor</title>
  <meta name="keywords" content="test_2d_resistor">
  <meta name="description" content="Create 2D model of a cylindrical resistor">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html eidors --><!-- menu.html tests -->
<h1>test_2d_resistor
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Create 2D model of a cylindrical resistor</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Create 2D model of a cylindrical resistor
 $Id$</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../eidors/algorithms/a_adler/aa_calc_jacobian.html" class="code" title="function J= aa_calc_jacobian( fwd_model, img)">aa_calc_jacobian</a>	AA_CALC_JACOBIAN: J= aa_calc_jacobian( fwd_model, img)</li><li><a href="../../eidors/algorithms/a_adler/aa_calc_system_mat.html" class="code" title="function s_mat= aa_calc_system_mat( fwd_model, img)">aa_calc_system_mat</a>	AA_CALC_SYSTEM_MAT: SS= aa_calc_system_mat( fwd_model, img)</li><li><a href="../../eidors/algorithms/a_adler/aa_fwd_solve.html" class="code" title="function data =aa_fwd_solve(fwd_model, img)">aa_fwd_solve</a>	AA_FWD_SOLVE: data= aa_fwd_solve( fwd_model, img)</li><li><a href="../../eidors/algorithms/a_adler/perturb_jacobian.html" class="code" title="function J= perturb_jacobian( fwd_model, img)">perturb_jacobian</a>	PERTURB_JACOBIAN: J= perturb_jacobian( fwd_model, img)</li><li><a href="../../eidors/algorithms/calc_jacobian.html" class="code" title="function J = calc_jacobian( fwd_model, img)">calc_jacobian</a>	CALC_JACOBIAN: calculate jacobian from an inv_model</li><li><a href="../../eidors/algorithms/n_polydorides/np_calc_jacobian.html" class="code" title="function J= np_calc_jacobian( fwd_model, img)">np_calc_jacobian</a>	NP_CALC_JACOBIAN: J= np_calc_jacobian( fwd_model, img)</li><li><a href="../../eidors/algorithms/n_polydorides/np_calc_system_mat.html" class="code" title="function s_mat= np_calc_system_mat( fwd_model, img)">np_calc_system_mat</a>	NP_CALC_SYSTEM_MAT: s_mat= np_calc_system_mat( fwd_model, img)</li><li><a href="../../eidors/algorithms/n_polydorides/np_fwd_solve.html" class="code" title="function data= np_fwd_solve( fwd_model, img)">np_fwd_solve</a>	NP_FWD_SOLVE: data= np_fwd_solve( fwd_model, img)</li><li><a href="../../eidors/eidors_obj.html" class="code" title="function obj_id= eidors_obj(type,name, varargin );">eidors_obj</a>	EIDORS_OBJ: 'constructor' to create a eidors structure</li><li><a href="../../eidors/fwd_solve.html" class="code" title="function data = fwd_solve( fwd_model, img)">fwd_solve</a>	FWD_SOLVE: calculate data from a fwd_model object and an image</li><li><a href="../../eidors/graphics_matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="../../eidors/models/a_adler/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec);">mk_grid_model</a>	MK_GRID_MODEL: Create reconstruction model on pixelated grid</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Create 2D model of a cylindrical resistor</span>
0002 <span class="comment">% $Id$</span>
0003 
0004 nn= 12;     <span class="comment">% number of nodes</span>
0005 ww=2;       <span class="comment">% width = 4</span>
0006 <span class="keyword">if</span> ~exist(<span class="string">'conduc'</span>);conduc=  .4;<span class="keyword">end</span>  <span class="comment">% conductivity in Ohm-meters</span>
0007 current= 4;  <span class="comment">% Amps</span>
0008 z_contact= 1e-2;
0009 scale = .35;
0010 mdl=<a href="../../eidors/models/a_adler/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec);">mk_grid_model</a>([],3+scale*(1:ww), scale*(1:nn/ww));
0011 mdl= rmfield(mdl,<span class="string">'coarse2fine'</span>); <span class="comment">% don't calc this.</span>
0012 
0013 mdl.gnd_node = 1;
0014 elec_nodes= [1:ww];
0015 elec(1).nodes= elec_nodes;      elec(1).z_contact= z_contact;
0016 elec(2).nodes= nn-elec_nodes+1; elec(2).z_contact= z_contact;
0017 stim.stim_pattern= [-1;1]*current;
0018 stim.meas_pattern= [-1,1];
0019 mdl.stimulation= stim;
0020 mdl.electrode= elec;
0021 <a href="../../eidors/graphics_matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(mdl);
0022 n_el = size(mdl.elems,1);
0023 img= <a href="../../eidors/eidors_obj.html" class="code" title="function obj_id= eidors_obj(type,name, varargin );">eidors_obj</a>(<span class="string">'image'</span>,<span class="string">'2D rectangle'</span>, <span class="keyword">...</span>
0024       <span class="string">'elem_data'</span>, ones(n_el,1) * conduc );
0025 
0026 <span class="comment">% AA_SOLVER</span>
0027 mdl.solve = @<a href="../../eidors/algorithms/a_adler/aa_fwd_solve.html" class="code" title="function data =aa_fwd_solve(fwd_model, img)">aa_fwd_solve</a>;
0028 mdl.system_mat = @<a href="../../eidors/algorithms/a_adler/aa_calc_system_mat.html" class="code" title="function s_mat= aa_calc_system_mat( fwd_model, img)">aa_calc_system_mat</a>;
0029 img.fwd_model = mdl;
0030 fsol= <a href="../../eidors/fwd_solve.html" class="code" title="function data = fwd_solve( fwd_model, img)">fwd_solve</a>(img);
0031 fprintf(<span class="string">'Solver %s: %f\n'</span>, fsol.name, fsol.meas);
0032 
0033 <span class="comment">% NP_SOLVER</span>
0034 mdl.solve = @<a href="../../eidors/algorithms/n_polydorides/np_fwd_solve.html" class="code" title="function data= np_fwd_solve( fwd_model, img)">np_fwd_solve</a>;
0035 mdl.system_mat = @<a href="../../eidors/algorithms/n_polydorides/np_calc_system_mat.html" class="code" title="function s_mat= np_calc_system_mat( fwd_model, img)">np_calc_system_mat</a>;
0036 img.fwd_model = mdl;
0037 fsol= <a href="../../eidors/fwd_solve.html" class="code" title="function data = fwd_solve( fwd_model, img)">fwd_solve</a>(img);
0038 fprintf(<span class="string">'Solver %s: %f\n'</span>, fsol.name, fsol.meas);
0039 
0040 <span class="comment">% analytical solution</span>
0041 wid_len= max(mdl.nodes) - min(mdl.nodes);
0042 R = wid_len(2) / wid_len(1) / conduc + 2*z_contact/scale;
0043 
0044 V= current*R;
0045 fprintf(<span class="string">'Solver %s: %f\n'</span>, <span class="string">'analytic'</span>, V);
0046 
0047 <span class="comment">% NOW CALCULATE THE ANALYTICAL JACOBIAN</span>
0048 mdl.solve = @<a href="../../eidors/algorithms/n_polydorides/np_fwd_solve.html" class="code" title="function data= np_fwd_solve( fwd_model, img)">np_fwd_solve</a>;
0049 mdl.jacobian = @<a href="../../eidors/algorithms/n_polydorides/np_calc_jacobian.html" class="code" title="function J= np_calc_jacobian( fwd_model, img)">np_calc_jacobian</a>;
0050 mg.elem_data= ones(n_el,1) * conduc ;
0051 Jnp= <a href="../../eidors/algorithms/calc_jacobian.html" class="code" title="function J = calc_jacobian( fwd_model, img)">calc_jacobian</a>(mdl,img);
0052 
0053 mdl.jacobian = @<a href="../../eidors/algorithms/a_adler/perturb_jacobian.html" class="code" title="function J= perturb_jacobian( fwd_model, img)">perturb_jacobian</a>;
0054 Jp1= <a href="../../eidors/algorithms/calc_jacobian.html" class="code" title="function J = calc_jacobian( fwd_model, img)">calc_jacobian</a>(mdl,img);
0055 
0056 img.elem_data= ones(n_el,1) * conduc ;
0057 Jp2= zeros(size(Jnp));
0058 delta= 1e-8;
0059 <span class="keyword">for</span> i=1:n_el
0060    fsol_h= <a href="../../eidors/fwd_solve.html" class="code" title="function data = fwd_solve( fwd_model, img)">fwd_solve</a>(img);
0061    img.elem_data(i) = img.elem_data(i) + delta;
0062    fsol_i= <a href="../../eidors/fwd_solve.html" class="code" title="function data = fwd_solve( fwd_model, img)">fwd_solve</a>(img);
0063    Jp2(:,i) = (fsol_i.meas - fsol_h.meas)/delta; 
0064 <span class="keyword">end</span>
0065    
0066 mdl.solve = @<a href="../../eidors/algorithms/a_adler/aa_fwd_solve.html" class="code" title="function data =aa_fwd_solve(fwd_model, img)">aa_fwd_solve</a>;
0067 mdl.jacobian = @<a href="../../eidors/algorithms/a_adler/aa_calc_jacobian.html" class="code" title="function J= aa_calc_jacobian( fwd_model, img)">aa_calc_jacobian</a>;
0068 Jaa= <a href="../../eidors/algorithms/calc_jacobian.html" class="code" title="function J = calc_jacobian( fwd_model, img)">calc_jacobian</a>(mdl,img);
0069 
0070 [Jaa;Jnp;Jp1;Jp2]
0071 
0072 
0073 
0074 
0075 <span class="comment">% TEST RESISTOR THAT IS NOT RECTANGULAR</span>
0076 nn= 12;     <span class="comment">% number of nodes</span>
0077 ww=2;       <span class="comment">% width = 4</span>
0078 <span class="keyword">if</span> ~exist(<span class="string">'conduc'</span>);conduc=  .4;<span class="keyword">end</span>  <span class="comment">% conductivity in Ohm-meters</span>
0079 current= 4;  <span class="comment">% Amps</span>
0080 z_contact= 1e-2;
0081 scale = .35;
0082 mdl=<a href="../../eidors/models/a_adler/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec);">mk_grid_model</a>([],3+scale*(1:ww), scale*(1:nn/ww));
0083 xdelta= .05*mdl.nodes(1:ww:nn,2);
0084 mdl.nodes(1:ww:nn,1) = mdl.nodes(1:ww:nn,1) + xdelta;
0085 mdl.nodes(2:ww:nn,1) = mdl.nodes(2:ww:nn,1) - xdelta;
0086 mdl.gnd_node = 1;
0087 elec_nodes= [1:ww];
0088 elec(1).nodes= elec_nodes;      elec(1).z_contact= z_contact;
0089 elec(2).nodes= nn-elec_nodes+1; elec(2).z_contact= z_contact;
0090 stim.stim_pattern= [-1;1]*current;
0091 stim.meas_pattern= [-1,1];
0092 mdl.stimulation= stim;
0093 mdl.electrode= elec;
0094 <a href="../../eidors/graphics_matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(mdl);
0095 n_el = size(mdl.elems,1);
0096 img= <a href="../../eidors/eidors_obj.html" class="code" title="function obj_id= eidors_obj(type,name, varargin );">eidors_obj</a>(<span class="string">'image'</span>,<span class="string">'2D rectangle'</span>, <span class="string">'fwd_model'</span>,mdl, <span class="keyword">...</span>
0097       <span class="string">'elem_data'</span>, ones(n_el,1) * conduc );
0098 <span class="comment">% AA_SOLVER</span>
0099 mdl.solve = @<a href="../../eidors/algorithms/a_adler/aa_fwd_solve.html" class="code" title="function data =aa_fwd_solve(fwd_model, img)">aa_fwd_solve</a>;
0100 mdl.system_mat = @<a href="../../eidors/algorithms/a_adler/aa_calc_system_mat.html" class="code" title="function s_mat= aa_calc_system_mat( fwd_model, img)">aa_calc_system_mat</a>;
0101 fsol= <a href="../../eidors/fwd_solve.html" class="code" title="function data = fwd_solve( fwd_model, img)">fwd_solve</a>(mdl,img);
0102 fprintf(<span class="string">'Solver %s: %f\n'</span>, fsol.name, fsol.meas);
0103 <span class="comment">% NP_SOLVER</span>
0104 mdl.solve = @<a href="../../eidors/algorithms/n_polydorides/np_fwd_solve.html" class="code" title="function data= np_fwd_solve( fwd_model, img)">np_fwd_solve</a>;
0105 mdl.system_mat = @<a href="../../eidors/algorithms/n_polydorides/np_calc_system_mat.html" class="code" title="function s_mat= np_calc_system_mat( fwd_model, img)">np_calc_system_mat</a>;
0106 fsol= <a href="../../eidors/fwd_solve.html" class="code" title="function data = fwd_solve( fwd_model, img)">fwd_solve</a>(mdl,img);
0107 fprintf(<span class="string">'Solver %s: %f\n'</span>, fsol.name, fsol.meas);
0108 
0109 <span class="comment">% Analytic</span>
0110 e1= mdl.nodes(mdl.electrode(1).nodes,:);
0111 d1= sqrt( sum(( [1,-1]*e1 ).^2 ));
0112 e2= mdl.nodes(mdl.electrode(2).nodes,:);
0113 d2= sqrt( sum(( [1,-1]*e2 ).^2 ));
0114 hig= max(mdl.nodes(:,2)) - min(mdl.nodes(:,2));
0115 <span class="comment">% R = int_h (1/d) dh</span>
0116 <span class="comment">% d= a+b*h; a= d1; b= (d2-d1)/hig</span>
0117 <span class="comment">% R = int 1/(a+b*h)*dh = log(a+bh)/b</span>
0118 <span class="comment">% R = [log(d2) - log(d1)]*hig/(d2-d1)</span>
0119 <span class="comment">% doesn't account for arc in conductivity pattern</span>
0120 R = (log(d2)-log(d1))*hig/(d2-d1)/conduc + 2*z_contact/scale;
0121 V= current*R;
0122 fprintf(<span class="string">'Solver %s: %f\n'</span>, <span class="string">'analytic'</span>, V);
0123 fprintf(<span class="string">'Analytic is not expected to be same in last case'</span>);</pre></div>
<hr><address>Generated on Wed 13-Jul-2011 23:23:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>