<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of find_boundary</title>
  <meta name="keywords" content="find_boundary">
  <meta name="description" content="[srf, idx] = find_boundary(simp);">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html eidors --><!-- ../menu.html algorithms --><!-- menu.html n_polydorides -->
<h1>find_boundary
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>[srf, idx] = find_boundary(simp);</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [srf, idx] = find_boundary(simp); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [srf, idx] = find_boundary(simp);

Caclulates the boundary faces of a given 3D volume.
Usefull in electrode assignment.

srf  =  array of elements on each boundary simplex
        boundary simplices are of 1 lower dimention than simp
idx  =  index of simplex to which each boundary belongs
simp = The simplices matrix</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>	[srf, idx] = find_boundary(simp);</li><li><a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG: eidors progress and status messages</li><li><a href="../../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/algorithms/a_adler/aa_fwd_parameters.html" class="code" title="function param = aa_fwd_parameters( fwd_model )">aa_fwd_parameters</a>	AA_FWD_PARAMETERS: data= aa_fwd_solve( fwd_model, image)</li><li><a href="../../../eidors/algorithms/b_grychtol/fix_model.html" class="code" title="function [mdl] = fix_model(mdl,options)">fix_model</a>	FIX_MODEL: Add useful fields to a model</li><li><a href="../../../eidors/algorithms/eidors_model_params.html" class="code" title="function mdl = eidors_model_params( mdl );">eidors_model_params</a>	mdl = eidors_model_params( mdl );</li><li><a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>	[srf, idx] = find_boundary(simp);</li><li><a href="np_fwd_parameters.html" class="code" title="function param = np_fwd_parameters( fwd_model )">np_fwd_parameters</a>	NP_FWD_PARAMETERS: data= np_fwd_solve( fwd_model )</li><li><a href="../../../eidors/examples/demo_real.html" class="code" title="function [inhomg_img, demo_img] = demo_real;">demo_real</a>	[inhomg_img, demo_img] = demo_real;</li><li><a href="../../../eidors/graphics_matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="../../../eidors/meshing/distmesh/dm_2d_pt_elecs.html" class="code" title="function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, params, shapefn, bbox);">dm_2d_pt_elecs</a>	DM_2D_PT_ELECS: Create circle mesh (or radius 1) refined</li><li><a href="../../../eidors/meshing/distmesh/dm_mk_fwd_model.html" class="code" title="function [fwd_mdl]= dm_mk_fwd_model( fd, fh, nnodes, bbox, elec_nodes,refine_nodes, z_contact, name)">dm_mk_fwd_model</a>	DM_MK_FWD_MODEL: create a fwd_model object using distmesh</li><li><a href="../../../eidors/meshing/netgen/ng_mk_cyl_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_cyl_models(cyl_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_cyl_models</a>	NG_MAKE_CYL_MODELS: create cylindrical models using netgen</li><li><a href="../../../eidors/meshing/netgen/ng_mk_ellip_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_ellip_models(ellip_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_ellip_models</a>	NG_MAKE_ELLIP_MODELS: create elliptical models using netgen</li><li><a href="../../../eidors/meshing/netgen/ng_mk_extruded_model.html" class="code" title="function [fmdl,mat_idx] = ng_mk_extruded_model(shape, elec_pos, elec_shape,extra_ng_code)">ng_mk_extruded_model</a>	NG_MAKE_EXTRUDED_MODEL: create extruded models using netgen</li><li><a href="../../../eidors/meshing/netgen/ng_mk_gen_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_gen_models(shape_str, elec_pos,  elec_shape, elec_obj);">ng_mk_gen_models</a>	NG_MAKE_ELLIP_MODELS: create elliptical models using netgen</li><li><a href="../../../eidors/models/a_adler/fwd_model_from_v2.html" class="code" title="function fmdl = fwd_model_from_v2( elec, vtx, bdy, simp, zc, gnd_ind, name)">fwd_model_from_v2</a>	CREATE EIDORS v3 fwd_model from the v2 variables</li><li><a href="../../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/a_adler/mk_fmdl_from_nodes.html" class="code" title="function mdl= mk_fmdl_from_nodes( vtx, elec_nodes, z_contact, name)">mk_fmdl_from_nodes</a>	MK_FMDL_FROM_NODES: create fmdl from nodes</li><li><a href="../../../eidors/models/a_adler/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec);">mk_grid_model</a>	MK_GRID_MODEL: Create reconstruction model on pixelated grid</li><li><a href="../../../eidors/models/s_murphy/set_fwd_model.html" class="code" title="function [fwd_mdl]=set_fwd_model(vtx,simp,srf,elec,zc,gnd_ind,Ib,indH,df,perm_sym);">set_fwd_model</a>	SET_FWD_MODEL: create EIDORS v3 fwd_model from v2 parameters</li><li><a href="../../../eidors/tests/demo_real_test2.html" class="code" title="function ok= demo_real_test2">demo_real_test2</a>	Perform tests based on the demo_real function with new structs</li><li><a href="../../../eidors/tests/demo_real_test3.html" class="code" title="function ok= demo_real_test3">demo_real_test3</a>	Perform tests based on the demo_real function with new structs</li><li><a href="../../../eidors/tests/test_3d_resistor.html" class="code" title="">test_3d_resistor</a>	Create 3D model of a Rectangular resistor</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [srf,idx]= find_2or3d_boundary(simp,dim);</a></li><li><a href="#_sub2" class="code">function do_unit_test</a></li><li><a href="#_sub3" class="code">function bdy= sort_boundary(bdy)</a></li><li><a href="#_sub4" class="code">function ok= match( pat1, pat2, ok, descr)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [srf, idx] = find_boundary(simp);</a>
0002 <span class="comment">% [srf, idx] = find_boundary(simp);</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%Caclulates the boundary faces of a given 3D volume.</span>
0005 <span class="comment">%Usefull in electrode assignment.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%srf  =  array of elements on each boundary simplex</span>
0008 <span class="comment">%        boundary simplices are of 1 lower dimention than simp</span>
0009 <span class="comment">%idx  =  index of simplex to which each boundary belongs</span>
0010 <span class="comment">%simp = The simplices matrix</span>
0011 
0012 <span class="comment">% $Id$</span>
0013 
0014 <span class="keyword">if</span> isstr(simp) &amp;&amp; strcmp(simp,<span class="string">'UNIT_TEST'</span>); <a href="#_sub2" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0015 <span class="keyword">if</span> isstruct(simp) &amp;&amp; strcmp(simp.type,<span class="string">'fwd_model'</span>); simp= simp.elems; <span class="keyword">end</span>
0016 
0017 wew = size(simp,2) - 1;
0018 
0019 <span class="keyword">if</span> wew==3 || wew==2
0020    [srf,idx]= <a href="#_sub1" class="code" title="subfunction [srf,idx]= find_2or3d_boundary(simp,dim);">find_2or3d_boundary</a>(simp,wew);
0021 <span class="keyword">else</span>
0022    <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'find_boundary: WARNING: not 2D or 3D simplices'</span>,1);
0023    srf=[]; <span class="keyword">return</span>;
0024 <span class="keyword">end</span>
0025 
0026 <span class="comment">% sort surfaces. If there is more than one, its not on the boundary</span>
0027 <a name="_sub1" href="#_subfunctions" class="code">function [srf,idx]= find_2or3d_boundary(simp,dim);</a>
0028    <span class="keyword">if</span> size(simp,1) &lt; 4e9 <span class="comment">% max of uint32</span>
0029       <span class="comment">% convert to integer to make sort faster</span>
0030       simp = uint32( simp );
0031    <span class="keyword">end</span>
0032    localface = nchoosek(1:dim+1,dim);
0033    srf_local= simp(:,localface');
0034    srf_local= reshape( srf_local', dim, []); <span class="comment">% D x 3E</span>
0035    srf_local= sort(srf_local)'; <span class="comment">% Sort each row</span>
0036    [sort_srl,sort_idx] = sortrows( srf_local );
0037 
0038    <span class="comment">% Fine the ones that are the same</span>
0039    first_ones =  sort_srl(1:end-1,:);
0040    next_ones  =  sort_srl(2:<span class="keyword">end</span>,:);
0041    same_srl = find( all( first_ones == next_ones, 2) );
0042 
0043    <span class="comment">% Assume they're all different. then find the same ones</span>
0044    diff_srl = logical(ones(size(srf_local,1),1));
0045    diff_srl(same_srl) = 0;
0046    diff_srl(same_srl+1) = 0;
0047 
0048    srf= sort_srl( diff_srl,: );
0049    idx= sort_idx( diff_srl);
0050    idx= ceil(idx/(dim+1));
0051 
0052 <a name="_sub2" href="#_subfunctions" class="code">function do_unit_test</a>
0053 ok=1;
0054 
0055 <span class="comment">%2D Test:</span>
0056 mdl = <a href="../../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'c2c'</span>,16);
0057 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0058 bdy = <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0059 bdyc= <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0060 
0061 ok= <a href="#_sub4" class="code" title="subfunction ok= match( pat1, pat2, ok, descr)">match</a>(bdy,bdyc,ok,<span class="string">'2D test'</span>);
0062 
0063 <span class="comment">%3D Test:</span>
0064 mdl = <a href="../../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'n3r2'</span>,16);
0065 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0066 bdy = <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0067 bdyc= <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0068 
0069 ok= <a href="#_sub4" class="code" title="subfunction ok= match( pat1, pat2, ok, descr)">match</a>(bdy,bdyc,ok,<span class="string">'3D test n3r2'</span>);
0070 
0071 <span class="comment">%3D Test:</span>
0072 mdl = <a href="../../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a3cr'</span>,16);
0073 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0074 bdy = <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0075 bdyc= <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0076 
0077 ok= <a href="#_sub4" class="code" title="subfunction ok= match( pat1, pat2, ok, descr)">match</a>(bdy,bdyc,ok,<span class="string">'3D test a3c2'</span>);
0078 
0079 <span class="comment">%3D Test:</span>
0080 mdl = <a href="../../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'b3cr'</span>,16);
0081 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0082 bdy = <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0083 bdyc= <a href="#_sub3" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0084 
0085 ok= <a href="#_sub4" class="code" title="subfunction ok= match( pat1, pat2, ok, descr)">match</a>(bdy,bdyc,ok,<span class="string">'3D test b3c2'</span>);
0086 
0087 <a name="_sub3" href="#_subfunctions" class="code">function bdy= sort_boundary(bdy)</a>
0088    bdy = sort(bdy,2);
0089    bdy = sortrows(bdy);
0090 
0091 <a name="_sub4" href="#_subfunctions" class="code">function ok= match( pat1, pat2, ok, descr)</a>
0092     ok =  all(pat1(:) == pat2(:));
0093     fprintf(<span class="string">'find_bounday_test: ok=%d\n'</span>,ok);
0094 
0095 <span class="comment">% function ok= match( pat1, pat2, ok, descr)</span>
0096 <span class="comment">%    if ~all(pat1(:) == pat2(:))</span>
0097 <span class="comment">%       ok=0;</span>
0098 <span class="comment">%       eidors_msg('find_bounday_test: fail %s',descr,1);</span>
0099 <span class="comment">%    end</span>
0100 
0101</pre></div>
<hr><address>Generated on Wed 13-Jul-2011 23:23:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>