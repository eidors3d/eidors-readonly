<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of show_slices</title>
  <meta name="keywords" content="show_slices">
  <meta name="description" content="out_img = show_slices (img, levels ) show slices at levels of an">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html eidors --><!-- menu.html graphics_matlab -->
<h1>show_slices
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>out_img = show_slices (img, levels ) show slices at levels of an</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function out_img= show_slices( img, levels ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> out_img = show_slices (img, levels ) show slices at levels of an
             using a fast rendering algorithm
 img    = EIDORS image struct, or a array of structs
 out_img= matrix in the current colormap which we can use image(out_img);

 PARAMETERS:
  levels = Matrix [Lx3] of L image levels
           each row of the matrix specifies the intercepts
           of the slice on the x, y, z axis. To specify a z=2 plane
           parallel to the x,y: use levels= [inf,inf,2]
  
  if levels is [L x 5] then levels= [x,y,z,h,v] where,
           x,y,z specify the axes intercepts, and 
           h,v   specify the horizontal, vertical position
                 of that slice in the output image
 
 IMAGE PARAMETERS:
   img.show_slices.levels (same as above);
   img.show_slices.img_cols = number of columns in image
   img.show_slices.sep = number of pixels between the individual images
   img.calc_colours.npoints = pixel width/height to map to

 if levels is scalar, then make levels equispaced horizontal
          cuts through the object

 Show slices is roughly equivalent to:
   rimg = calc_slices(img,levels); 
   rimg = calc_colours(rimg,img); image(rimg);</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../eidors/algorithms/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>	CALC_JACOBIAN_BKGND: calculate background image around</li><li><a href="../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG: eidors progress and status messages</li><li><a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>	[colours,scl_data]= calc_colours(img, set_value, do_colourbar)</li><li><a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>	calc_slices (img, levels, clim  ) show slices at levels of an</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../eidors/algorithms/b_grychtol/inv_solve_TSVD.html" class="code" title="function sol = inv_solve_TSVD(inv_model, data1, data2)">inv_solve_TSVD</a>	INV_SOLVE_TSVD: inverse solver based on truncatated SVD</li><li><a href="../../eidors/examples/cheating_2d.html" class="code" title="function out=cheating_2d( figno, rand_seed )">cheating_2d</a>	code to simulate inverse crimes in EIT</li><li><a href="../../eidors/examples/compare_2d_algs.html" class="code" title="function [imgr, img]= compare_2d_algs(option,shape);">compare_2d_algs</a>	Compare different 2D reconstructions</li><li><a href="../../eidors/examples/compare_3d_algs.html" class="code" title="function imgr= compare_3d_algs( algno )">compare_3d_algs</a>	Compare different 3D reconstructions</li><li><a href="../../eidors/examples/demo_2d_simdata.html" class="code" title="">demo_2d_simdata</a>	Example of using EIDORS to simulate 2D data and to</li><li><a href="../../eidors/examples/demo_3d_simdata.html" class="code" title="">demo_3d_simdata</a>	How to make simulation data using EIDORS3D</li><li><a href="../../eidors/examples/demo_real.html" class="code" title="function [inhomg_img, demo_img] = demo_real;">demo_real</a>	[inhomg_img, demo_img] = demo_real;</li><li><a href="../../eidors/examples/manchester_tomography.html" class="code" title="function manchester_tomography( example_no)">manchester_tomography</a>	Example to show reconstructions from</li><li><a href="animate_reconstructions.html" class="code" title="function fname_out= animate_reconstructions(fname, imgs);">animate_reconstructions</a>	animate_reconstructions(fname, imgs);</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="show_slices_move.html" class="code" title="function show_slices_move( img, move, move_scale )">show_slices_move</a>	SHOW_SLICES_MOVE   Shows planar slices of a 3D FEM with movement vectors</li><li><a href="../../eidors/interface/find_frc.html" class="code" title="function [eexpi,einsp]= find_frc( imgs, ROI, frate, name, ok, remove_pts)">find_frc</a>	FIND_FRC: find candidates for FRC</li><li><a href="../../eidors/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>	INV_SOLVE: calculate imag from an inv_model and data</li><li><a href="../../eidors/models/a_adler/mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>	MK_GREIT_MODEL: make EIDORS inverse models using the GREIT approach</li><li><a href="../../eidors/models/a_adler/select_imdl.html" class="code" title="function inv_mdl= select_imdl( mdl, options )">select_imdl</a>	SELECT_IMDL: select pre-packaged inverse model features</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function do_unit_test</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function out_img= show_slices( img, levels )</a>
0002 <span class="comment">% out_img = show_slices (img, levels ) show slices at levels of an</span>
0003 <span class="comment">%             using a fast rendering algorithm</span>
0004 <span class="comment">% img    = EIDORS image struct, or a array of structs</span>
0005 <span class="comment">% out_img= matrix in the current colormap which we can use image(out_img);</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% PARAMETERS:</span>
0008 <span class="comment">%  levels = Matrix [Lx3] of L image levels</span>
0009 <span class="comment">%           each row of the matrix specifies the intercepts</span>
0010 <span class="comment">%           of the slice on the x, y, z axis. To specify a z=2 plane</span>
0011 <span class="comment">%           parallel to the x,y: use levels= [inf,inf,2]</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%  if levels is [L x 5] then levels= [x,y,z,h,v] where,</span>
0014 <span class="comment">%           x,y,z specify the axes intercepts, and</span>
0015 <span class="comment">%           h,v   specify the horizontal, vertical position</span>
0016 <span class="comment">%                 of that slice in the output image</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% IMAGE PARAMETERS:</span>
0019 <span class="comment">%   img.show_slices.levels (same as above);</span>
0020 <span class="comment">%   img.show_slices.img_cols = number of columns in image</span>
0021 <span class="comment">%   img.show_slices.sep = number of pixels between the individual images</span>
0022 <span class="comment">%   img.calc_colours.npoints = pixel width/height to map to</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% if levels is scalar, then make levels equispaced horizontal</span>
0025 <span class="comment">%          cuts through the object</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% Show slices is roughly equivalent to:</span>
0028 <span class="comment">%   rimg = calc_slices(img,levels);</span>
0029 <span class="comment">%   rimg = calc_colours(rimg,img); image(rimg);</span>
0030 
0031 <span class="comment">% (C) 2005-2008 Andy Adler. License: GPL version 2 or version 3</span>
0032 <span class="comment">% $Id$</span>
0033 
0034 <span class="keyword">if</span> isstr(img) &amp;&amp; strcmp(img,<span class="string">'UNIT_TEST'</span>); <a href="#_sub1" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0035 
0036 np = <a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>(<span class="string">'npoints'</span>);
0037 <span class="keyword">try</span>   np = img(1).calc_colours.npoints;
0038 <span class="keyword">end</span>
0039 
0040 sep = 0;
0041 <span class="keyword">try</span> sep = img(1).show_slices.sep;
0042 <span class="keyword">end</span>
0043 
0044 
0045 do_calc_slices = 0;
0046 <span class="keyword">try</span> <span class="keyword">if</span> strcmp(img(1).type,<span class="string">'image'</span>); do_calc_slices= 1; <span class="keyword">end</span>;<span class="keyword">end</span> 
0047 
0048 <span class="keyword">if</span> nargin&lt;=1;
0049    <span class="keyword">try</span>   levels = img(1).show_slices.levels
0050    <span class="keyword">catch</span> levels = [];
0051    <span class="keyword">end</span>
0052 <span class="keyword">end</span>
0053 
0054 <span class="keyword">if</span> isempty(levels) &amp;&amp; do_calc_slices &amp;&amp; size(img(1).fwd_model.nodes,2)==2
0055    levels= [Inf,Inf,0];
0056 <span class="keyword">end</span>
0057 
0058 <span class="keyword">if</span> size(levels,2) == 5
0059    spec_position= 1;
0060 <span class="keyword">elseif</span> size(levels)== [1,1]
0061    <span class="keyword">if</span> size(img(1).fwd_model.nodes,2) == 2 <span class="comment">% Can't do horiz slices for 2D model</span>
0062       <a href="../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'Can''t do horizontal slices for 2D model. Showing 2D slice'</span>);
0063       levels= [Inf,Inf,0];
0064       spec_position= 0;
0065    <span class="keyword">else</span>
0066       zmax= max(img(1).fwd_model.nodes(:,3));
0067       zmin= min(img(1).fwd_model.nodes(:,3));
0068       levels = linspace(zmax,zmin, levels+2);
0069       levels = levels(2:end-1)';
0070       levels = [(1+0*levels)*[Inf,Inf], levels];
0071       spec_position= 0;
0072    <span class="keyword">end</span>
0073 <span class="keyword">else</span>
0074    spec_position= 0;
0075 <span class="keyword">end</span>
0076 
0077 <span class="keyword">if</span> do_calc_slices
0078    rimg= <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>( img, levels(:,1:3) );
0079 <span class="keyword">else</span>
0080    rimg= img;
0081    np = size(rimg,1);
0082 <span class="keyword">end</span>
0083 
0084 
0085 n_frames = size(rimg,3);
0086 n_levels = size(rimg,4);
0087 <span class="keyword">if</span> spec_position <span class="comment">%won't work for multiple image inputs</span>
0088    img_cols = max( levels(:,4) );
0089    img_rows = max( levels(:,5) );
0090 <span class="keyword">else</span>
0091    <span class="comment">% vertical slices must be kept together</span>
0092    <span class="comment">% To nicely fill the image: img_cols ~ img_rows</span>
0093    <span class="comment">% Thus,  n_frames/vert_rows ~ vert_rows*n_levels;</span>
0094    <span class="comment">% or     vert_rows^2 ~ n_frames / n_levels</span>
0095    vert_rows = ceil( sqrt(n_frames / n_levels) );
0096    <span class="keyword">try</span>   img_cols = img(1).show_slices.img_cols;
0097    <span class="keyword">catch</span> img_cols = ceil( n_frames/vert_rows );
0098    <span class="keyword">end</span>
0099    img_rows = ceil(n_frames*n_levels/img_cols);
0100    img_rows = ceil(img_rows/n_levels)*n_levels; <span class="comment">% Ensure divisible by n_levels</span>
0101 <span class="keyword">end</span>
0102 <span class="comment">% here include the separation</span>
0103 r_img = NaN*ones(img_rows*np + (img_rows-1)*sep, <span class="keyword">...</span>
0104     img_cols*np + (img_cols-1)*sep );
0105 
0106 idx= (-np:-1)+1;
0107 imno= 1;
0108 <span class="keyword">for</span> img_no = 1:n_frames
0109    <span class="keyword">for</span> lev_no = 1:n_levels
0110       <span class="keyword">if</span> spec_position <span class="comment">%won't work for multiple image inputs</span>
0111          i_col= levels( lev_no, 4) + img_no -1;
0112          i_row= levels( lev_no, 5);
0113       <span class="keyword">else</span>
0114          i_col= rem( img_no-1, img_cols) + 1;
0115          i_row= (ceil( img_no / img_cols) -1) * n_levels + lev_no ;
0116       <span class="keyword">end</span>
0117 <span class="comment">% disp([imno, vert_rows, img_cols, img_rows, img_no, lev_no, i_col, i_row]);</span>
0118       r_img(i_row*np + idx + sep*(i_row-1), i_col*np + idx +sep*(i_col-1)) = rimg(:,:,img_no,lev_no);
0119       imno= imno + 1; 
0120    <span class="keyword">end</span>
0121 <span class="keyword">end</span>
0122 
0123 c_img = <a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>( r_img, img);
0124 out_img= reshape(c_img, size(r_img,1), size(r_img,2) ,[]);
0125 
0126 
0127 image(out_img);
0128 axis(<span class="string">'image'</span>);axis(<span class="string">'off'</span>);axis(<span class="string">'equal'</span>);
0129 
0130 <span class="keyword">if</span> nargout==0; clear(<span class="string">'out_img'</span>); <span class="keyword">end</span>
0131 
0132 
0133 <a name="_sub1" href="#_subfunctions" class="code">function do_unit_test</a>
0134    clf
0135 
0136    img=<a href="../../eidors/algorithms/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>(<a href="../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a2c0'</span>,8)); 
0137    img.elem_data=rand(size(img.fwd_model.elems,1),1);
0138    subplot(3,4,1); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(img) 
0139 
0140    img.calc_colours.npoints= 128;
0141    subplot(3,4,2); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(img) 
0142 
0143    img.calc_colours.npoints= 32;
0144    img.elem_data=rand(size(img.fwd_model.elems,1),3);
0145    subplot(3,4,3); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(img) 
0146 
0147    img.show_slices.img_cols= 1;
0148    subplot(3,4,4); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(img) 
0149 
0150    imgn = rmfield(img,<span class="string">'elem_data'</span>);
0151    imgn.node_data=rand(size(img.fwd_model.nodes,1),1);
0152    subplot(3,4,5); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(imgn) 
0153 
0154    img=<a href="../../eidors/algorithms/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>(<a href="../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'n3r2'</span>,32)); 
0155    img.calc_colours.npoints= 16;
0156    img.elem_data=rand(size(img.fwd_model.elems,1),1);
0157    subplot(3,4,6); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(img,2) 
0158 
0159    img.elem_data=img.elem_data*[1:3];
0160    subplot(3,4,7); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(img,2) 
0161 
0162    img.elem_data=img.elem_data(:,1:2);
0163    subplot(3,4,8); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels )">show_slices</a>(img,[inf,inf,1;0,inf,inf;0,1,inf]);</pre></div>
<hr><address>Generated on Wed 13-Jul-2011 23:23:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>