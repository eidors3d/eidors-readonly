<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of mk_stim_patterns</title>
  <meta name="keywords" content="mk_stim_patterns">
  <meta name="description" content="MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html eidors --><!-- # models --><!-- menu.html a_adler -->
<h1>mk_stim_patterns
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure
                to form part of a fwd_model object
 [stim, meas_sel] = mk_stim_patterns( n_elec, n_rings, ...
                                      inj, meas, options, amplitude)

 where
 stim(#).stimulation = 'mA'
     (#).stim_pattern= [vector n_elec*n_rings x 1 ]
     (#).meas_pattern= [matrix n_elec*n_rings x n_meas_patterns]

 for example, for an adjacent pattern for 4 electrodes, with 0.5mA
   if all electrodes are used for measurement
 stim(1).stim_pattern= [0.5;-0.5;0;0]
 stim(1).meas_pattern= [1, 0, 0,-1 
                       -1, 1, 0, 0 
                        0,-1, 1, 0 
                        0, 0,-1, 1]

 meas_sel: when not using data from current injection electrodes,
           it is common to be given a full measurement set.
           For example 16 electrodes gives 208 measures, but 256
           measure sets are common. 'meas_sel' indicates which
           electrodes are used

 PARAMETERS:
   n_elec:   number of electrodes per ring
   n_rings:  number of electrode rings (1 for 2D)

   inj: injection pattern
      '{ad}'        -&gt; adjacent drive: equivalent to [0 1]
      '{op}'        -&gt; opposite drive: equivalent to [0, n_elec/2]
      '{trig}'      -&gt; trigonometric drive [cos,sin,cos,sin ...]
                       '{trig}' implies the 'meas_current' option.
      '{trigcscs}'  -&gt; trigonometric drive [cos,sin,cos,sin ...]
      '{trigccss}'  -&gt; trigonometric drive [cos,cos, ... sin,sin, ...]
      '{mono}'      -&gt; Drive via each elec, current leaves by ground
      Bi-polar injection patterns:
        [x y]: First pattern is [x,y] next is [x+1,y+1] 
      Mono-polar injection patterns:
        [x]:   First pattern is [x]   next is [x+1] 

   meas: measurement pattern
      '{ad}'        -&gt; adjacent measurement
      '{op}'        -&gt; opposite drive: equivalent to [0, n_elec/2]
      '{trig}'      -&gt; trigonometric drive [sin,cos,sin,cos ...]
      '{mono}'      -&gt; Meas at each elec (Reminder, you may want to set meas_current);
      Bi-polar measurement patterns:
        [x y]: First pattern is [x,y] next is [x+1,y+1] 
      Mono-polar measurement patterns:
        [x]:   First pattern is [x]   next is [x+1] 

   options: cell array of options, eg {'no_meas_current'}
     if contradictory options are specified, only the last applies
      'no_meas_current' / 'meas_current'
         -&gt; do / don't make mesurements on current carrying electrodes
      'rotate_meas' / 'no_rotate_meas'
         -&gt; do / don't rotate measurements with stimulation pattern
      'do_redundant' / 'no_redundant'
         -&gt; do / don't make reciprocally redundant measures
      'balance_inj' / 'no_balance_inj'
         -&gt; do / don't draw current from all electrodes so total
            injection is zero (useful for mono patterns)
      'balance_meas' / 'no_balance_meas'
         -&gt; do / don't subtrant measurement from all electrodes so total
            average measurement is zero (useful for mono patterns)

   amplitude: drive current levels, DEFAULT = 1mA</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>	MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure</li><li><a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>	UNIT_TEST_CMP: compare matrices in eidors output</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/examples/cheating_2d.html" class="code" title="function out=cheating_2d( figno, rand_seed )">cheating_2d</a>	code to simulate inverse crimes in EIT</li><li><a href="../../../eidors/examples/demo_2d_simdata.html" class="code" title="">demo_2d_simdata</a>	Example of using EIDORS to simulate 2D data and to</li><li><a href="../../../eidors/examples/demo_3d_simdata.html" class="code" title="">demo_3d_simdata</a>	How to make simulation data using EIDORS3D</li><li><a href="../../../eidors/examples/eidors2d_demo1.html" class="code" title="">eidors2d_demo1</a>	EidorsDemo1 Demonstrates the use of 2D EIT Package with linear basis</li><li><a href="../../../eidors/examples/image_2d_algs.html" class="code" title="">image_2d_algs</a>	Based on the 'bubble' data from Eidors2D, use several</li><li><a href="../../../eidors/examples/manchester_tomography.html" class="code" title="function manchester_tomography( example_no)">manchester_tomography</a>	Example to show reconstructions from</li><li><a href="../../../eidors/examples/moving_tank_objs.html" class="code" title="function imgs= moving_tank_objs(data_sel, inv_sel, options)">moving_tank_objs</a>	MOVING_TANK_OBJS: create movies of objects moving in tanks</li><li><a href="../../../eidors/examples/object_in_tank_2d.html" class="code" title="">object_in_tank_2d</a>	2D demo example for reconstruction of object floating inside tank with</li><li><a href="../../../eidors/interface/eidors_readdata.html" class="code" title="function [vv, auxdata, stim ]= eidors_readdata( fname, format, frame_range, extra )">eidors_readdata</a>	EIDORS readdata - read data files from various EIT equipment</li><li><a href="mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>	MK_GREIT_MODEL: make EIDORS inverse models using the GREIT approach</li><li><a href="mk_common_gridmdl.html" class="code" title="function inv_mdl= mk_common_gridmdl( str, RM)">mk_common_gridmdl</a>	MK_COMMON_MODEL: make EIT on reconstruction grids (GREIT)</li><li><a href="mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>	MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure</li><li><a href="reciprocity_idx.html" class="code" title="function idxr = reciprocity_idx( fmdl);">reciprocity_idx</a>	RECIPROCITY_IDX: find indices of stim, meas pairs that are recirocal</li><li><a href="simulate_2d_movement.html" class="code" title="function [vh,vi,xyr_pt]= simulate_2d_movement( n_sims, fmdl, rad_pr, movefcn )">simulate_2d_movement</a>	SIMULATE_2D_MOVEMENT simulate rotational movement in 2D</li><li><a href="test_GREIT_model.html" class="code" title="">test_GREIT_model</a>	</li><li><a href="../../../eidors/tests/calc_data_prior_test.html" class="code" title="function ok= calc_data_prior_test">calc_data_prior_test</a>	Verify dataprior:</li><li><a href="../../../eidors/tests/calc_jacobian_test.html" class="code" title="function ok= calc_jacobian_test">calc_jacobian_test</a>	Verify Jacobian Calculation by small derivative from forward problem</li><li><a href="../../../eidors/tests/mk_stim_patterns_test.html" class="code" title="function ok= mk_stim_patterns_test">mk_stim_patterns_test</a>	Verify mk_stim_patterns function</li><li><a href="../../../eidors/tools/test_performance.html" class="code" title="function [r, params] =  test_performance( imdls, fmdl );">test_performance</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li><li><a href="../../../eidors/tools/test_performance_img.html" class="code" title="function [params_img] =  test_performance_img( imdls, fmdl );">test_performance_img</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [stim,mpat] = calc_stim(v, n_elec, n_rings)</a></li><li><a href="#_sub2" class="code">function meas_sel= meas_select( mpat, mpat0);</a></li><li><a href="#_sub3" class="code">function [mset,err] = mk_meas_set( meas_pat )</a></li><li><a href="#_sub4" class="code">function stim_pat = mk_stim_pat(v, elec, ring );</a></li><li><a href="#_sub5" class="code">function meas = mk_meas_pat(v, elec, ring );</a></li><li><a href="#_sub6" class="code">function v = process_args(n_elec, n_rings, inj, meas, options, amplitude )</a></li><li><a href="#_sub7" class="code">function v= parse_options(v, options);</a></li><li><a href="#_sub8" class="code">function [m_pat, seen_patterns] = elim_redundant(m_pat, s_pat, seen_patterns);</a></li><li><a href="#_sub9" class="code">function pat= trig_pat( elec_sel, n_elecs, sel);</a></li><li><a href="#_sub10" class="code">function do_unit_test</a></li><li><a href="#_sub11" class="code">function ok= test_adj(pat)</a></li><li><a href="#_sub12" class="code">function ok= test_adj_full(pat)</a></li><li><a href="#_sub13" class="code">function ok= test_adj_rotate(pat)</a></li><li><a href="#_sub14" class="code">function ok= test_adj_no_redund(pat)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [stim, meas_sel]= mk_stim_patterns( </a><span class="keyword">...</span>
0002             n_elec, n_rings, inj, meas, options, amplitude)
0003 <span class="comment">%MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure</span>
0004 <span class="comment">%                to form part of a fwd_model object</span>
0005 <span class="comment">% [stim, meas_sel] = mk_stim_patterns( n_elec, n_rings, ...</span>
0006 <span class="comment">%                                      inj, meas, options, amplitude)</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% where</span>
0009 <span class="comment">% stim(#).stimulation = 'mA'</span>
0010 <span class="comment">%     (#).stim_pattern= [vector n_elec*n_rings x 1 ]</span>
0011 <span class="comment">%     (#).meas_pattern= [matrix n_elec*n_rings x n_meas_patterns]</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% for example, for an adjacent pattern for 4 electrodes, with 0.5mA</span>
0014 <span class="comment">%   if all electrodes are used for measurement</span>
0015 <span class="comment">% stim(1).stim_pattern= [0.5;-0.5;0;0]</span>
0016 <span class="comment">% stim(1).meas_pattern= [1, 0, 0,-1</span>
0017 <span class="comment">%                       -1, 1, 0, 0</span>
0018 <span class="comment">%                        0,-1, 1, 0</span>
0019 <span class="comment">%                        0, 0,-1, 1]</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% meas_sel: when not using data from current injection electrodes,</span>
0022 <span class="comment">%           it is common to be given a full measurement set.</span>
0023 <span class="comment">%           For example 16 electrodes gives 208 measures, but 256</span>
0024 <span class="comment">%           measure sets are common. 'meas_sel' indicates which</span>
0025 <span class="comment">%           electrodes are used</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% PARAMETERS:</span>
0028 <span class="comment">%   n_elec:   number of electrodes per ring</span>
0029 <span class="comment">%   n_rings:  number of electrode rings (1 for 2D)</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%   inj: injection pattern</span>
0032 <span class="comment">%      '{ad}'        -&gt; adjacent drive: equivalent to [0 1]</span>
0033 <span class="comment">%      '{op}'        -&gt; opposite drive: equivalent to [0, n_elec/2]</span>
0034 <span class="comment">%      '{trig}'      -&gt; trigonometric drive [cos,sin,cos,sin ...]</span>
0035 <span class="comment">%                       '{trig}' implies the 'meas_current' option.</span>
0036 <span class="comment">%      '{trigcscs}'  -&gt; trigonometric drive [cos,sin,cos,sin ...]</span>
0037 <span class="comment">%      '{trigccss}'  -&gt; trigonometric drive [cos,cos, ... sin,sin, ...]</span>
0038 <span class="comment">%      '{mono}'      -&gt; Drive via each elec, current leaves by ground</span>
0039 <span class="comment">%      Bi-polar injection patterns:</span>
0040 <span class="comment">%        [x y]: First pattern is [x,y] next is [x+1,y+1]</span>
0041 <span class="comment">%      Mono-polar injection patterns:</span>
0042 <span class="comment">%        [x]:   First pattern is [x]   next is [x+1]</span>
0043 <span class="comment">%</span>
0044 <span class="comment">%   meas: measurement pattern</span>
0045 <span class="comment">%      '{ad}'        -&gt; adjacent measurement</span>
0046 <span class="comment">%      '{op}'        -&gt; opposite drive: equivalent to [0, n_elec/2]</span>
0047 <span class="comment">%      '{trig}'      -&gt; trigonometric drive [sin,cos,sin,cos ...]</span>
0048 <span class="comment">%      '{mono}'      -&gt; Meas at each elec (Reminder, you may want to set meas_current);</span>
0049 <span class="comment">%      Bi-polar measurement patterns:</span>
0050 <span class="comment">%        [x y]: First pattern is [x,y] next is [x+1,y+1]</span>
0051 <span class="comment">%      Mono-polar measurement patterns:</span>
0052 <span class="comment">%        [x]:   First pattern is [x]   next is [x+1]</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%   options: cell array of options, eg {'no_meas_current'}</span>
0055 <span class="comment">%     if contradictory options are specified, only the last applies</span>
0056 <span class="comment">%      'no_meas_current' / 'meas_current'</span>
0057 <span class="comment">%         -&gt; do / don't make mesurements on current carrying electrodes</span>
0058 <span class="comment">%      'rotate_meas' / 'no_rotate_meas'</span>
0059 <span class="comment">%         -&gt; do / don't rotate measurements with stimulation pattern</span>
0060 <span class="comment">%      'do_redundant' / 'no_redundant'</span>
0061 <span class="comment">%         -&gt; do / don't make reciprocally redundant measures</span>
0062 <span class="comment">%      'balance_inj' / 'no_balance_inj'</span>
0063 <span class="comment">%         -&gt; do / don't draw current from all electrodes so total</span>
0064 <span class="comment">%            injection is zero (useful for mono patterns)</span>
0065 <span class="comment">%      'balance_meas' / 'no_balance_meas'</span>
0066 <span class="comment">%         -&gt; do / don't subtrant measurement from all electrodes so total</span>
0067 <span class="comment">%            average measurement is zero (useful for mono patterns)</span>
0068 <span class="comment">%</span>
0069 <span class="comment">%   amplitude: drive current levels, DEFAULT = 1mA</span>
0070 
0071 <span class="comment">% (C) 2005 Andy Adler. License: GPL version 2 or version 3</span>
0072 <span class="comment">% $Id$</span>
0073 
0074 <span class="keyword">if</span> isstr(n_elec) &amp;&amp; strcmp(n_elec,<span class="string">'UNIT_TEST'</span>); <a href="#_sub10" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0075 
0076 <span class="keyword">if</span> nargin&lt;6; amplitude= 1; <span class="keyword">end</span>
0077 <span class="keyword">if</span> nargin&lt;5; options= {};  <span class="keyword">end</span>
0078 v = <a href="#_sub6" class="code" title="subfunction v = process_args(n_elec, n_rings, inj, meas, options, amplitude )">process_args</a>(n_elec, n_rings, inj, meas, options, amplitude );
0079 
0080 [stim,mpat ] = <a href="#_sub1" class="code" title="subfunction [stim,mpat] = calc_stim(v, n_elec, n_rings)">calc_stim</a>(v, n_elec, n_rings);
0081 
0082 <span class="comment">% Meas_sel selects meas which would exist if we measured all of them</span>
0083 v.do_redundant = 1; v.use_meas_current = 1; 
0084 [jnk ,mpat0] = <a href="#_sub1" class="code" title="subfunction [stim,mpat] = calc_stim(v, n_elec, n_rings)">calc_stim</a>(v, n_elec, n_rings);
0085 
0086 <span class="comment">%meas_sel= meas_select_old( n_elec, v.inj, v);</span>
0087  meas_sel= <a href="#_sub2" class="code" title="subfunction meas_sel= meas_select( mpat, mpat0);">meas_select</a>( mpat, mpat0);
0088 
0089 <a name="_sub1" href="#_subfunctions" class="code">function [stim,mpat] = calc_stim(v, n_elec, n_rings)</a>
0090    curr_pat = v.inj(:) * ones(1,n_elec);
0091    meas_pat = v.meas(:) * ones(1,n_elec);
0092    offset   = [1;1]*(0:n_elec-1);
0093 
0094    stim= struct([]);
0095    mpat= struct([]);
0096    i=1; j=1;
0097    <span class="keyword">for</span> ring = 0:v.n_rings-1
0098       seen_patterns= struct;
0099       <span class="keyword">for</span> elec= 0:v.n_elec-1
0100           <span class="keyword">if</span> v.trig_inj &amp;&amp; elec == v.n_elec-1 ; <span class="keyword">continue</span>; <span class="keyword">end</span> <span class="comment">% No indep patterns</span>
0101           s_pat= <a href="#_sub4" class="code" title="subfunction stim_pat = mk_stim_pat(v, elec, ring );">mk_stim_pat</a>(v, elec, ring );
0102           m_pat= <a href="#_sub5" class="code" title="subfunction meas = mk_meas_pat(v, elec, ring );">mk_meas_pat</a>(v, elec, ring );
0103 
0104           <span class="keyword">if</span> v.do_redundant == 0 <span class="comment">% elim redudant</span>
0105              [m_pat, seen_patterns] = <a href="#_sub8" class="code" title="subfunction [m_pat, seen_patterns] = elim_redundant(m_pat, s_pat, seen_patterns);">elim_redundant</a>(m_pat, s_pat, seen_patterns);
0106           <span class="keyword">end</span>
0107 
0108           <span class="keyword">if</span> ~isempty(m_pat) 
0109               stim(i).stimulation = <span class="string">'mA'</span>;
0110               stim(i).stim_pattern= sparse(s_pat);
0111               stim(i).meas_pattern= sparse(m_pat);
0112               i=i+1;
0113           <span class="keyword">end</span>
0114               mpat(j).meas_pattern= sparse(m_pat);
0115               j=j+1;
0116       <span class="keyword">end</span>
0117    <span class="keyword">end</span>
0118 
0119 <span class="comment">% when not using data from current injection electrodes,</span>
0120 <span class="comment">% it is common to be given a full measurement set.</span>
0121 <span class="comment">% For example 16 electrodes gives 208 measures, but 256</span>
0122 <span class="comment">% measure sets are common.</span>
0123 <span class="comment">% This function calculates a selector matrix to remove the extra</span>
0124 <span class="comment">%</span>
0125 <span class="comment">% reshape(meas_select( 6, [0,1], v),6,6) 0 0 1 1 1 0</span>
0126 <span class="comment">%                                        0 0 0 1 1 1</span>
0127 <span class="comment">%                                        1 0 0 0 1 1</span>
0128 <span class="comment">%                                        1 1 0 0 0 1</span>
0129 <span class="comment">%                                        1 1 1 0 0 0</span>
0130 <span class="comment">%                                        0 1 1 1 0 0</span>
0131 <span class="comment">%</span>
0132 <span class="comment">% reshape(meas_select( 6, [0,2], v),6,6) 0 0 1 1 0 0</span>
0133 <span class="comment">%                                        0 0 0 1 1 0</span>
0134 <span class="comment">%                                        0 0 0 0 1 1</span>
0135 <span class="comment">%                                        1 0 0 0 0 1</span>
0136 <span class="comment">%                                        1 1 0 0 0 0</span>
0137 <span class="comment">%                                        0 1 1 0 0 0</span>
0138 <span class="comment">%</span>
0139 <span class="comment">% reshape(meas_select( 6, [0,3], v),6,6) 0 0 1 0 0 1</span>
0140 <span class="comment">%                                        1 0 0 1 0 0</span>
0141 <span class="comment">%                                        0 1 0 0 1 0</span>
0142 <span class="comment">%                                        0 0 1 0 0 1</span>
0143 <span class="comment">%                                        1 0 0 1 0 0</span>
0144 <span class="comment">%                                        0 1 0 0 1 0</span>
0145 <a name="_sub2" href="#_subfunctions" class="code">function meas_sel= meas_select( mpat, mpat0);</a>
0146    meas_sel = [];
0147    <span class="keyword">for</span> i=1:length(mpat);
0148       [mset,  err ] = <a href="#_sub3" class="code" title="subfunction [mset,err] = mk_meas_set( meas_pat )">mk_meas_set</a>( mpat(i).meas_pattern );
0149       [mset0, err0] = <a href="#_sub3" class="code" title="subfunction [mset,err] = mk_meas_set( meas_pat )">mk_meas_set</a>( mpat0(i).meas_pattern );
0150       <span class="keyword">if</span> err || err0; msel_i = 1 + 0*mset; <span class="comment">% Set to 1 for error</span>
0151       <span class="keyword">else</span>            msel_i = ismember(mset0,mset);
0152       <span class="keyword">end</span>
0153       meas_sel = [meas_sel; msel_i];
0154    <span class="keyword">end</span>
0155 
0156    meas_sel = logical(meas_sel(:));
0157 
0158 <a name="_sub3" href="#_subfunctions" class="code">function [mset,err] = mk_meas_set( meas_pat )</a>
0159    mpats= size(~meas_pat,1);
0160    mset = zeros(mpats,1);
0161    err=0;
0162    <span class="keyword">for</span> i=1:size(meas_pat,1);
0163       mpat = meas_pat(i,:);
0164       fp = find(mpat&gt;0); <span class="keyword">if</span> length(fp)==0; fp = 0; <span class="keyword">end</span>
0165       fn = find(mpat&lt;0); <span class="keyword">if</span> length(fn)==0; fn = 0; <span class="keyword">end</span>
0166       <span class="keyword">if</span> length(fp)&gt;1 || length(fn)&gt;1 ; err=1; <span class="keyword">return</span>; <span class="keyword">end</span>
0167       mset(i) =  fp*1e7 + fn;
0168    <span class="keyword">end</span>
0169 
0170 <a name="_sub4" href="#_subfunctions" class="code">function stim_pat = mk_stim_pat(v, elec, ring );</a>
0171    stim_pat = sparse(v.tn_elec, 1);
0172    <span class="keyword">if</span> v.balance_inj
0173       stim_pat= stim_pat - sum(v.i_factor)/ (v.tn_elec-1);
0174    <span class="keyword">elseif</span> v.trig_inj
0175       stim_pat = <a href="#_sub9" class="code" title="subfunction pat= trig_pat( elec_sel, n_elecs, sel);">trig_pat</a>( elec, v.tn_elec, v.trig_inj) * v.amplitude;
0176       <span class="keyword">return</span>;
0177    <span class="keyword">end</span>
0178 
0179    stim_idx = rem( v.inj + elec, v.n_elec) + 1 + v.n_elec*ring;
0180    stim_pat( stim_idx ) = v.amplitude*v.i_factor;
0181 
0182 <span class="comment">% Measurement config can stay static, or can rotate with</span>
0183 <span class="comment">% the stim pattern. This code keeps measurements static</span>
0184 <a name="_sub5" href="#_subfunctions" class="code">function meas = mk_meas_pat(v, elec, ring );</a>
0185    meas= sparse(v.tn_elec, v.tn_elec);
0186    <span class="keyword">if</span> v.balance_meas
0187       meas= meas - sum(v.m_factor)/ (v.tn_elec-1);
0188    <span class="keyword">elseif</span> v.trig_meas
0189       meas= <a href="#_sub9" class="code" title="subfunction pat= trig_pat( elec_sel, n_elecs, sel);">trig_pat</a>( 1:v.tn_elec, v.tn_elec)';
0190       <span class="keyword">return</span>;
0191    <span class="keyword">end</span>
0192 
0193    <span class="keyword">if</span> v.rotate_meas
0194       ofs = elec;
0195    <span class="keyword">else</span>
0196       ofs = 0;
0197    <span class="keyword">end</span> 
0198 
0199    mseq= 0:v.tn_elec-1;
0200    within_ring = rem(v.n_elec +  mseq , v.n_elec);
0201    ouside_ring = floor( mseq / v.n_elec) * v.n_elec;
0202    meas_seq    = mseq *v.tn_elec + 1;
0203 
0204    <span class="keyword">for</span> i=1:length(v.meas)
0205       meas_pat = rem( v.meas(i) + within_ring + ofs, v.n_elec ) + <span class="keyword">...</span>
0206                        ouside_ring + meas_seq;
0207       meas(meas_pat) = v.m_factor(i);
0208    <span class="keyword">end</span>
0209 
0210    <span class="keyword">if</span> v.use_meas_current == 0
0211        stim_idx = rem( v.inj + elec, v.n_elec) + 1 + v.n_elec*ring;
0212    <span class="comment">% each column of meas is a measurement pattern</span>
0213    <span class="comment">% Test whether each col has contribution from stim</span>
0214        elim= any(meas(stim_idx,:),1);
0215        meas(:,elim) = [];
0216    <span class="keyword">end</span>
0217 
0218    meas= meas';
0219 
0220 
0221 <a name="_sub6" href="#_subfunctions" class="code">function v = process_args(n_elec, n_rings, inj, meas, options, amplitude )</a>
0222 
0223 <span class="comment">% SET DEFAULTS</span>
0224    v.trig_meas= 0;
0225    v.trig_inj = 0;
0226 
0227    v.use_meas_current = 0;
0228    v.rotate_meas = 0;
0229    v.do_redundant = 1;
0230    v.balance_inj = 0;
0231    v.balance_meas= 0;
0232 
0233 <span class="comment">% Stimulation (injection) pattern</span>
0234 <span class="comment">% This currently does not handle complicated injection patterns</span>
0235 <span class="keyword">if</span> isstr(inj)
0236    <span class="keyword">if</span>      strcmp(inj,<span class="string">'{ad}'</span>)
0237       inj= [0, 1];
0238       rel_ampl= [-1;1];
0239    <span class="keyword">elseif</span>  strcmp(inj,<span class="string">'{op}'</span>)
0240       inj= [0, floor(n_elec/2)];
0241       rel_ampl= [-1;1];
0242    <span class="keyword">elseif</span>  strcmp(inj,<span class="string">'{trig}'</span>)
0243       v.trig_inj = 1;
0244       v.use_meas_current = 1; <span class="comment">% We need to measure on the electrodes</span>
0245       rel_ampl= [];
0246    <span class="keyword">elseif</span>  strcmp(inj,<span class="string">'{trigcscs}'</span>)
0247       v.trig_inj = 1;
0248       v.use_meas_current = 1; <span class="comment">% We need to measure on the electrodes</span>
0249       rel_ampl= [];
0250    <span class="keyword">elseif</span>  strcmp(inj,<span class="string">'{trigccss}'</span>)
0251       v.trig_inj = 2;
0252       v.use_meas_current = 1; <span class="comment">% We need to measure on the electrodes</span>
0253       rel_ampl= [];
0254    <span class="keyword">elseif</span>  strcmp(inj,<span class="string">'{mono}'</span>)
0255       inj= [0];
0256       rel_ampl= [1];
0257    <span class="keyword">else</span>
0258       error([<span class="string">'parameter inj='</span>,inj,<span class="string">' not understood'</span>]);
0259    <span class="keyword">end</span>
0260 <span class="keyword">elseif</span> prod(size(inj))==1
0261       rel_ampl= [1];
0262 <span class="keyword">elseif</span> prod(size(inj))==2
0263       rel_ampl= [-1;1];
0264 <span class="keyword">else</span>
0265       error([<span class="string">'parameter inj not understood'</span>]);
0266 <span class="keyword">end</span>
0267 
0268 v.inj= inj;
0269 v.i_factor=      rel_ampl;
0270 
0271 <span class="comment">% Measurement configuration.</span>
0272 <span class="comment">% All systems I know of use adjacent measurement,</span>
0273 <span class="comment">% are there actually any others?</span>
0274 <span class="keyword">if</span> isstr(meas)
0275    <span class="keyword">if</span>      strcmp(meas,<span class="string">'{ad}'</span>)
0276       meas=     [0, 1];
0277       rel_ampl= [ 1;-1];
0278    <span class="keyword">elseif</span>  strcmp(meas,<span class="string">'{op}'</span>)
0279       meas= [0, floor(n_elec/2)];
0280       rel_ampl= [ 1;-1];
0281    <span class="keyword">elseif</span>  strcmp(meas,<span class="string">'{trig}'</span>)
0282       v.trig_meas= 1;
0283       rel_ampl= [ 1;-1];
0284    <span class="keyword">elseif</span>  strcmp(meas,<span class="string">'{mono}'</span>)
0285       meas= [0];
0286       rel_ampl= [1];
0287    <span class="keyword">else</span>
0288       error([<span class="string">'parameter meas='</span>,meas,<span class="string">' not understood'</span>]);
0289    <span class="keyword">end</span>
0290 <span class="keyword">elseif</span> prod(size(meas))==1
0291       rel_ampl= [1];
0292 <span class="keyword">elseif</span> prod(size(meas))==2
0293       rel_ampl= [ 1;-1];
0294 <span class="keyword">else</span>
0295       error([<span class="string">'parameter meas not understood'</span>]);
0296 <span class="keyword">end</span>
0297 
0298 v.meas=          meas;
0299 v.m_factor=      rel_ampl;
0300 
0301 v.n_elec = n_elec;
0302 v.n_rings= n_rings;
0303 v.tn_elec= n_rings * n_elec;
0304 v.amplitude = amplitude;
0305 
0306 v= <a href="#_sub7" class="code" title="subfunction v= parse_options(v, options);">parse_options</a>(v, options);
0307 
0308 <a name="_sub7" href="#_subfunctions" class="code">function v= parse_options(v, options);</a>
0309 <span class="comment">% iterate through the options cell array</span>
0310 <span class="keyword">for</span> opt = options
0311    <span class="keyword">if</span>     strcmp(opt, <span class="string">'no_meas_current'</span>)
0312       v.use_meas_current = 0;
0313    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'meas_current'</span>)
0314       v.use_meas_current = 1;
0315    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'rotate_meas'</span>)
0316       v.rotate_meas = 1;
0317    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'no_rotate_meas'</span>)
0318       v.rotate_meas = 0;
0319    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'do_redundant'</span>)
0320       v.do_redundant = 1;
0321    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'no_redundant'</span>)
0322       v.do_redundant = 0;
0323    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'balance_inj'</span>)
0324       v.balance_inj = 1;
0325    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'no_balance_inj'</span>)
0326       v.balance_inj = 0;
0327    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'balance_meas'</span>)
0328       v.balance_meas= 1;
0329    <span class="keyword">elseif</span> strcmp(opt, <span class="string">'no_balance_meas'</span>)
0330       v.balance_meas= 0;
0331    <span class="keyword">else</span>
0332       error([<span class="string">'option parameter opt='</span>,opt,<span class="string">' not understood'</span>]);
0333    <span class="keyword">end</span>
0334 <span class="keyword">end</span>
0335 
0336 <a name="_sub8" href="#_subfunctions" class="code">function [m_pat, seen_patterns] = elim_redundant(m_pat, s_pat, seen_patterns);</a>
0337    m_pat_new= sparse([]);
0338    s_pat_str= [<span class="string">'s'</span>,sprintf(<span class="string">'%d_'</span>, find(s_pat) ),<span class="string">'m'</span>];
0339    <span class="keyword">for</span> j=1:size(m_pat,1);
0340       this_m_pat= m_pat(j,:);
0341       pat_str= [s_pat_str, sprintf(<span class="string">'%d_'</span>, find(this_m_pat))];
0342       <span class="keyword">if</span> ~isfield(seen_patterns,pat_str);
0343          m_pat_new= [m_pat_new;this_m_pat];
0344          <span class="comment">% we've seen this pattern</span>
0345          seen_patterns.(pat_str)= 1;
0346          <span class="comment">% and it's dual by reciprocity</span>
0347          pat_str= [<span class="string">'s'</span>,sprintf(<span class="string">'%d_'</span>, find(this_m_pat) ), <span class="keyword">...</span>
0348                    <span class="string">'m'</span>,sprintf(<span class="string">'%d_'</span>, find(s_pat))];
0349          seen_patterns.(pat_str)= 1;
0350       <span class="keyword">end</span>
0351    <span class="keyword">end</span>
0352    m_pat= m_pat_new;
0353 
0354 <span class="comment">% create trig patterns.</span>
0355 <span class="comment">%</span>
0356 <span class="comment">% n_elecs is total number of electrodes</span>
0357 <span class="comment">% elec    is the electrodes selected (can be multiple)</span>
0358 <span class="comment">%         (elec goes from 0 to n_elecs-1</span>
0359 <span class="comment">% if sel = 1 -&gt; cos|sin|cos|sin (default)</span>
0360 <span class="comment">% if sel = 2 -&gt; cos|cos|sin|sin</span>
0361 <span class="comment">%</span>
0362 <a name="_sub9" href="#_subfunctions" class="code">function pat= trig_pat( elec_sel, n_elecs, sel);</a>
0363     <span class="keyword">if</span> nargin&lt;3; sel=1; <span class="keyword">end</span>
0364     idx= linspace(0,2*pi,n_elecs+1)'; idx(end)= [];
0365     omega= idx*[1:n_elecs/2];
0366     meas_pat= [cos(omega), sin(omega) ];
0367     <span class="keyword">if</span> sel==1;
0368        <span class="comment">% reorder so we get cos|sin|cos|sin</span>
0369        order = reshape(1:n_elecs,[],2)';
0370        meas_pat= meas_pat(:,order(:));
0371     <span class="keyword">end</span>
0372     meas_pat= meas_pat(:,1:end-1); <span class="comment">% only n_elecs-1 independent patterns</span>
0373     pat  = meas_pat(:, elec_sel+1);
0374 
0375 <a name="_sub10" href="#_subfunctions" class="code">function do_unit_test</a>
0376    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],[0,1],{},1);
0377    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'t1'</span>,stim(1).stim_pattern, [-1;1;0;0]);
0378    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'t2'</span>,stim(4).stim_pattern, [1;0;0;-1]);
0379    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'t3'</span>,stim(1).meas_pattern, [0,0,1,-1]);
0380    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'t4'</span>,stim(4).meas_pattern, [0,1,-1,0]);
0381 
0382 <span class="comment">%      'no_meas_current' / 'meas_current'</span>
0383 <span class="comment">%         -&gt; do / don't make mesurements on current carrying electrodes</span>
0384    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],[0,1],{<span class="string">'meas_current'</span>},1);
0385    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_current: t1'</span>,stim(1).meas_pattern,  <span class="keyword">...</span>
0386          [1,-1,0,0; 0,1,-1,0; 0,0,1,-1; -1,0,0,1]);
0387    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_current: t2'</span>,stim(4).stim_pattern, [1;0;0;-1]);
0388    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],[0,1],{<span class="string">'no_meas_current'</span>},1);
0389    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_current: t3'</span>,stim(1).meas_pattern,  [0,0,1,-1]);
0390    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_current: t2'</span>,stim(4).stim_pattern, [1;0;0;-1]);
0391 
0392 <span class="comment">%      'rotate_meas' / 'no_rotate_meas'</span>
0393 <span class="comment">%         -&gt; do / don't rotate measurements with stimulation pattern</span>
0394 
0395    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'no_rotate_meas'</span>},1);
0396    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_rotate_meas: t1'</span>,stim(2).stim_pattern, [0;-1;1;0;0;0]);
0397    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_rotate_meas: t2'</span>,stim(2).meas_pattern, <span class="keyword">...</span>
0398          [0,0,0,1,-1,0; 0,0,0,0,1,-1; -1,0,0,0,0,1]);
0399    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_rotate_meas: t3'</span>,stim(3).stim_pattern, [0;0;-1;1;0;0]);
0400    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_rotate_meas: t4'</span>,stim(3).meas_pattern, <span class="keyword">...</span>
0401          [1,-1,0,0,0,0;0,0,0,0,1,-1; -1,0,0,0,0,1]);
0402 
0403    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'rotate_meas'</span>},1);
0404    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'rotate_meas: t1'</span>,stim(2).stim_pattern, [0;-1;1;0;0;0]);
0405    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'rotate_meas: t2'</span>,stim(2).meas_pattern, <span class="keyword">...</span>
0406          [0,0,0,1,-1,0; 0,0,0,0,1,-1; -1,0,0,0,0,1]);
0407    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'rotate_meas: t3'</span>,stim(3).stim_pattern, [0;0;-1;1;0;0]);
0408    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'rotate_meas: t4'</span>,stim(3).meas_pattern, <span class="keyword">...</span>
0409          [0,0,0,0,1,-1; -1,0,0,0,0,1; 1,-1,0,0,0,0]);
0410 
0411 <span class="comment">%      'do_redundant' / 'no_redundant'</span>
0412 <span class="comment">%         -&gt; do / don't make reciprocally redundant measures</span>
0413    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'do_redundant'</span>},1);
0414 
0415    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'do_redundant: t0'</span>,length(stim), 6);
0416    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'do_redundant: t1'</span>,stim(2).stim_pattern, [0;-1;1;0;0;0]);
0417    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'do_redundant: t2'</span>,stim(2).meas_pattern, <span class="keyword">...</span>
0418          [0,0,0,1,-1,0; 0,0,0,0,1,-1; -1,0,0,0,0,1]);
0419    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'do_redundant: t3'</span>,stim(3).stim_pattern, [0;0;-1;1;0;0]);
0420    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'do_redundant: t4'</span>,stim(3).meas_pattern, <span class="keyword">...</span>
0421          [1,-1,0,0,0,0;0,0,0,0,1,-1; -1,0,0,0,0,1]);
0422 
0423    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'no_redundant'</span>},1);
0424    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_redundant: t0'</span>,length(stim), 4);
0425    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_redundant: t1'</span>,stim(2).stim_pattern, [0;-1;1;0;0;0]);
0426    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_redundant: t2'</span>,stim(2).meas_pattern, <span class="keyword">...</span>
0427          [0,0,0,1,-1,0; 0,0,0,0,1,-1; -1,0,0,0,0,1]);
0428    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_redundant: t3'</span>,stim(3).stim_pattern, [0;0;-1;1;0;0]);
0429    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_redundant: t4'</span>,stim(3).meas_pattern, <span class="keyword">...</span>
0430          [0,0,0,0,1,-1;-1,0,0,0,0,1]);
0431    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_redundant: t5'</span>,stim(4).meas_pattern, <span class="keyword">...</span>
0432          [-1,0,0,0,0,1]);
0433 
0434 <span class="comment">%      'balance_inj' / 'no_balance_inj'</span>
0435 <span class="comment">%         -&gt; do / don't draw current from all electrodes so total</span>
0436 <span class="comment">%            injection is zero (useful for mono patterns)</span>
0437    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,<span class="string">'{mono}'</span>,[0,1],{<span class="string">'balance_inj'</span>,<span class="string">'meas_current'</span>},1);
0438    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'balance_inj: t0'</span>,length(stim), 4);
0439    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'balance_inj: t1'</span>,stim(2).stim_pattern, -[1;-3;1;1]/3);
0440    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'balance_inj: t2'</span>,stim(2).meas_pattern, <span class="keyword">...</span>
0441          [1,-1,0,0;0,1,-1,0;0,0,1,-1;-1,0,0,1]);
0442 
0443    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,<span class="string">'{mono}'</span>,[0,1],{<span class="string">'no_balance_inj'</span>,<span class="string">'no_meas_current'</span>},1);
0444    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_inj: t0'</span>,length(stim), 4);
0445    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_inj: t1'</span>,stim(2).stim_pattern, [0;1;0;0]);
0446    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_inj: t2'</span>,stim(2).meas_pattern, <span class="keyword">...</span>
0447          [0,0,1,-1;-1,0,0,1]);
0448 
0449    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,<span class="string">'{mono}'</span>,[0,1],{},1);
0450    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_inj: t0'</span>,length(stim), 4);
0451    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_inj: t1'</span>,stim(2).stim_pattern, [0;1;0;0]);
0452 
0453 <span class="comment">%      'balance_meas' / 'no_balance_meas'</span>
0454 <span class="comment">%         -&gt; do / don't subtrant measurement from all electrodes so total</span>
0455 <span class="comment">%            average measurement is zero (useful for mono patterns)</span>
0456    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],<span class="string">'{mono}'</span>,{<span class="string">'no_balance_meas'</span>,<span class="string">'meas_current'</span>},1);
0457    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t0'</span>,length(stim), 4);
0458    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).stim_pattern, [0;-1;1;0]);
0459    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).meas_pattern, eye(4));
0460 
0461    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],<span class="string">'{mono}'</span>,{<span class="string">'meas_current'</span>},1);
0462    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t0'</span>,length(stim), 4);
0463    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).stim_pattern, [0;-1;1;0]);
0464    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).meas_pattern, eye(4));
0465 
0466    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],<span class="string">'{mono}'</span>,{<span class="string">'no_meas_current'</span>},1);
0467    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t0'</span>,length(stim), 4);
0468    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).stim_pattern, [0;-1;1;0]);
0469    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).meas_pattern, [1,0,0,0;0,0,0,1]);
0470 
0471    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],<span class="string">'{mono}'</span>,{},1); <span class="comment">% DO WE WANT THIS AS DEFAULT??</span>
0472    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t0'</span>,length(stim), 4);
0473    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).stim_pattern, [0;-1;1;0]);
0474    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'no_balance_meas: t1'</span>,stim(2).meas_pattern, [1,0,0,0;0,0,0,1]);
0475 
0476    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],<span class="string">'{mono}'</span>,{<span class="string">'balance_meas'</span>,<span class="string">'meas_current'</span>},1);
0477    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'balance_meas: t0'</span>,length(stim), 4);
0478    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'balance_meas: t1'</span>,stim(2).stim_pattern, [0;-1;1;0]);
0479    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'balance_meas: t1'</span>,stim(2).meas_pattern, (4*eye(4)-ones(4))/3);
0480 
0481    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,[0,1],[0,1],{},2);
0482    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'amplitude: t1'</span>,stim(2).stim_pattern, [0;-2;2;0]);
0483    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,<span class="string">'{ad}'</span>,[0,1],{},2);
0484    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'amplitude: t2'</span>,stim(2).stim_pattern, [0;-2;2;0]);
0485    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,<span class="string">'{mono}'</span>,[0,1],{<span class="string">'no_balance_inj'</span>},2);
0486    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'amplitude: t3'</span>,stim(2).stim_pattern, [0;2;0;0]);
0487    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,<span class="string">'{mono}'</span>,[0,1],{},2);
0488    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'amplitude: t4'</span>,stim(2).stim_pattern, [0;2;0;0]);
0489    stim = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(4,1,<span class="string">'{trig}'</span>,[0,1],{},2);
0490    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'amplitude: t5'</span>,stim(2).stim_pattern, [0;2;0;-2],1e-5);
0491   
0492    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,2],[0,1],{<span class="string">'meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0493    msel = reshape(msel, 6, 6);
0494    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: t1'</span>,msel(:,6), [1;1;1;1;1;1]);
0495 
0496 <span class="keyword">if</span> 0
0497    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,2],[0,1],{<span class="string">'meas_current'</span>,<span class="string">'rotate_meas'</span>},2);
0498    msel = reshape(msel, 6, 6);
0499    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: t1'</span>,msel(:,6), [1;1;1;1;1;1]);
0500 
0501    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0502    msel = reshape(msel, 6, 6);
0503    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: t1'</span>,msel(:,6), [0;1;1;1;0;0]);
0504 
0505    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,2],[0,1],{<span class="string">'meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0506    msel = reshape(msel, 6, 6);
0507    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: t1'</span>,msel(:,6), [0;1;1;1;0;0]); <span class="comment">%%%</span>
0508 <span class="keyword">end</span>
0509 
0510    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0511    msel = reshape(msel, 6, 6);
0512    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp01'</span>,msel(:,[4,5]), [1,1;1,1;0,1;0,0;0,0;1,0]);
0513 
0514    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,2],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0515    msel = reshape(msel, 6, 6);
0516    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp02'</span>,msel(:,[4,5]), [1,0;1,1;0,1;0,0;0,0;0,0]);
0517 
0518    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,3],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0519    msel = reshape(msel, 6, 6);
0520    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp03'</span>,msel(:,[4,5]), [0,0;1,0;0,1;0,0;1,0;0,1]);
0521 
0522    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[1,2],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0523    msel = reshape(msel, 6, 6);
0524    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp12'</span>,msel(:,[4,5]), [1,0;1,1;1,1;0,1;0,0;0,0]);
0525 
0526    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[2,4],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0527    msel = reshape(msel, 6, 6);
0528    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp24'</span>,msel(:,[4,5]), [0,0;0,0;1,0;1,1;0,1;0,0]);
0529 
0530    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[2,4],[3,6],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0531    msel = reshape(msel, 6, 6);
0532    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp2436'</span>,msel(:,[4,5]), [1,0;0,1;0,0;1,0;0,1;0,0]);
0533 
0534    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'rotate_meas'</span>},2);
0535    msel = reshape(msel, 6, 6);
0536    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nrp01'</span>,msel(:,6), [0;0;1;1;1;0]);
0537 
0538    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,2],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'rotate_meas'</span>},2);
0539    msel = reshape(msel, 6, 6);
0540    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nrp02'</span>,msel(:,6), [0;0;0;1;1;0]);
0541 
0542    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,2],[3,4],{<span class="string">'no_meas_current'</span>,<span class="string">'rotate_meas'</span>},2);
0543    msel = reshape(msel, 6, 6);
0544    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nrp0234'</span>,msel(:,6), [1;1;0;0;0;0]);
0545 
0546    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,1],[0,1],{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>,<span class="string">'no_redundant'</span>},2);
0547    msel = reshape(msel, 6, 6);
0548    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp01'</span>,msel(:,[2,5]), [0,0;0,0;0,0;1,0;1,0;1,0]);
0549 
0550    [stim,msel] = <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(6,1,[0,2],<span class="string">'{mono}'</span>,{<span class="string">'no_meas_current'</span>,<span class="string">'no_rotate_meas'</span>},2);
0551    msel = reshape(msel, 6, 6);
0552    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'meas_sel: nnp2436'</span>,msel(:,[4,5]), [1,0;1,1;1,1;0,1;1,0;0,1]);
0553 
0554 <span class="comment">% TESTS FROM OLD mk_stim_patterns_test CODE</span>
0555    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>);
0556    <a href="#_sub11" class="code" title="subfunction ok= test_adj(pat)">test_adj</a>(pat);
0557 
0558    options= {<span class="string">'no_rotate_meas'</span>};
0559    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, options);
0560    <a href="#_sub11" class="code" title="subfunction ok= test_adj(pat)">test_adj</a>(pat);
0561 
0562    options= {<span class="string">'no_rotate_meas'</span>, <span class="string">'no_meas_current'</span>};
0563    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, options);
0564    <a href="#_sub11" class="code" title="subfunction ok= test_adj(pat)">test_adj</a>(pat);
0565 
0566    options= {<span class="string">'no_rotate_meas'</span>, <span class="string">'meas_current'</span>};
0567    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, options);
0568    <a href="#_sub12" class="code" title="subfunction ok= test_adj_full(pat)">test_adj_full</a>(pat);
0569 
0570    options= {<span class="string">'meas_current'</span>};
0571    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, options);
0572    <a href="#_sub12" class="code" title="subfunction ok= test_adj_full(pat)">test_adj_full</a>(pat);
0573 
0574    options= {<span class="string">'rotate_meas'</span>};
0575    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, options);
0576    <a href="#_sub13" class="code" title="subfunction ok= test_adj_rotate(pat)">test_adj_rotate</a>(pat);
0577 
0578    options= {<span class="string">'rotate_meas'</span>, <span class="string">'no_meas_current'</span>};
0579    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, options);
0580    <a href="#_sub13" class="code" title="subfunction ok= test_adj_rotate(pat)">test_adj_rotate</a>(pat);
0581 
0582    options= {<span class="string">'rotate_meas'</span>,<span class="string">'no_redundant'</span>, <span class="string">'no_meas_current'</span>};
0583    pat= <a href="mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16,1,<span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, options);
0584    <a href="#_sub14" class="code" title="subfunction ok= test_adj_no_redund(pat)">test_adj_no_redund</a>(pat);
0585 
0586 <a name="_sub11" href="#_subfunctions" class="code">function ok= test_adj(pat)</a>
0587    <span class="comment">%%%  test adjacent current pattern</span>
0588 
0589    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#01'</span>, length(pat), 16);
0590    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#02'</span>, pat(1).stimulation, <span class="string">'mA'</span>);
0591    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#03'</span>, pat(1).stim_pattern, [-1;1;zeros(14,1)]); <span class="comment">% Stim pattern # 1</span>
0592 
0593    meas= pat(1).meas_pattern;
0594    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#04'</span>, size(meas), [13 16] );
0595    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#05'</span>, meas(1,:), [0,0,1,-1,zeros(1,12)] );
0596    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#06'</span>, meas(13,:), [zeros(1,14),1,-1] );
0597    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#07'</span>, pat(10).stim_pattern , [zeros(9,1);-1;1;zeros(5,1)] );
0598 
0599    meas= pat(10).meas_pattern;
0600    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#08'</span>, size(meas), [13 16] );
0601    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#09'</span>, meas(1,:), [1,-1,zeros(1,14)] );
0602    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#10'</span>, meas(13,:), [-1,zeros(1,14),1] );
0603 
0604 <a name="_sub12" href="#_subfunctions" class="code">function ok= test_adj_full(pat)</a>
0605    <span class="comment">%%% test adjacent current pattern (full)</span>
0606 
0607    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#11'</span>, length(pat), 16);
0608    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#12'</span>, pat(1).stimulation, <span class="string">'mA'</span>);
0609    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#13'</span>, pat(1).stim_pattern, [-1;1;zeros(14,1)]);
0610 
0611    meas= pat(1).meas_pattern;
0612    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#14'</span>, size(meas), [16 16] );
0613    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#15'</span>, meas(1,:), [1,-1,zeros(1,14)] );
0614    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#16'</span>, meas(13,:), [zeros(1,12),1,-1,0,0] );
0615    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#17'</span>, pat(10).stim_pattern, [zeros(9,1);-1;1;zeros(5,1)] );
0616 
0617    meas= pat(10).meas_pattern;
0618    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#18'</span>, size(meas), [16 16] );
0619    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#19'</span>, meas(1,:), [1,-1,zeros(1,14)] );
0620    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#20'</span>, meas(13,:), [zeros(1,12),1,-1,0,0] );
0621 
0622 
0623 <a name="_sub13" href="#_subfunctions" class="code">function ok= test_adj_rotate(pat)</a>
0624    <span class="comment">%%%% test adjacent current pattern (rotate)</span>
0625 
0626    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#21'</span>, length(pat), 16);
0627    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#22'</span>, pat(1).stimulation, <span class="string">'mA'</span>);
0628    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#23'</span>, pat(1).stim_pattern, [-1;1;zeros(14,1)]);
0629 
0630    meas= pat(1).meas_pattern;
0631    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#24'</span>, size(meas), [13 16] );
0632    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#25'</span>, meas(1,:), [0,0,1,-1,zeros(1,12)] );
0633    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#26'</span>, meas(13,:), [zeros(1,14),1,-1] );
0634    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#27'</span>, pat(10).stim_pattern, [zeros(9,1);-1;1;zeros(5,1)] );
0635 
0636    meas= pat(10).meas_pattern;
0637    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#28'</span>, size(meas), [13 16] );
0638    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#29'</span>, meas(1,:), [zeros(1,11),1,-1,zeros(1,3)] );
0639    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#30'</span>, meas(13,:), [zeros(1,7),1,-1,zeros(1,7)] );
0640 
0641 <a name="_sub14" href="#_subfunctions" class="code">function ok= test_adj_no_redund(pat)</a>
0642    <span class="comment">%%% test adjacent current pattern (rotate)</span>
0643 
0644    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#31'</span>, length(pat), 14);
0645    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#32'</span>, pat(1).stimulation, <span class="string">'mA'</span>);
0646    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#33'</span>, pat(1).stim_pattern, [-1;1;zeros(14,1)]);
0647 
0648    meas= pat(1).meas_pattern;
0649    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#34'</span>, size(meas), [13 16] );
0650    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#35'</span>, meas(1,:), [0,0,1,-1,zeros(1,12)] );
0651    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#36'</span>, meas(13,:), [zeros(1,14),1,-1] );
0652    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#37'</span>, pat(10).stim_pattern, [zeros(9,1);-1;1;zeros(5,1)] );
0653 
0654    meas= pat(10).meas_pattern;
0655    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#38'</span>, size(meas), [5 16] );
0656    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#39'</span>, meas(1,:), [zeros(1,11),1,-1,zeros(1,3)] );
0657    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'pt#40'</span>, meas(5,:), [-1,zeros(1,14),1] );
0658</pre></div>
<hr><address>Generated on Wed 13-Jul-2011 23:23:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>