<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of moving_tank_objs</title>
  <meta name="keywords" content="moving_tank_objs">
  <meta name="description" content="MOVING_TANK_OBJS: create movies of objects moving in tanks">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html?eidors/examples/moving_tank_objs.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html eidors --><!-- menu.html examples -->
<h1>moving_tank_objs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>MOVING_TANK_OBJS: create movies of objects moving in tanks</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function imgs= moving_tank_objs(data_sel, inv_sel, options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> MOVING_TANK_OBJS: create movies of objects moving in tanks
 Usage:
 imgs= moving_tank_objs(data_sel, inv_sel, options)

 imgs = reconstructed images

 data_sel select data_sel to use
   data_sel: 10 =&gt; target across tank data
             20 =&gt; target around tank data
             21 =&gt; target around tank data (10 positions)
             30 =&gt; from netgen simulations (spiral)
             32 =&gt; from netgen simulations (spirograph)
             40 =&gt; show netgen FEM simulation

   if data_sel is a vector of EIT data, then it will
      be used for the reconstruction. The first measurement
      is the homogeneous, and the next are the data

 inv_sel
  2D reconstructions
   inv_sel = 1   =&gt; aa_inv_solve
   inv_sel = 1.1 =&gt; aa_inv_solve (576 elems)
   inv_sel = 2   =&gt; inv_kalman_diff

   if inv_sel is a inv_model structure, then use it to
   do reconstructions.

 options (not changed if value is NaN);
   options(1) - noise figure
   options(2) - time_steps
   options(3) - time_weight
 
 Create moving objects and tanks
 $Id$</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../eidors/algorithms/a_adler/aa_inv_conj_grad.html" class="code" title="function img= aa_inv_conj_grad( inv_model, data1, data2)">aa_inv_conj_grad</a>	AA_INV_CONJ_GRAD inverse solver based on the CG</li><li><a href="../../eidors/algorithms/a_adler/choose_noise_figure.html" class="code" title="function HP= choose_noise_figure( inv_model );">choose_noise_figure</a>	CHOOSE_NOISE_FIGURE: choose hyperparameter based on NF calculation</li><li><a href="../../eidors/algorithms/a_adler/inv_kalman_diff.html" class="code" title="function img= inv_kalman_diff( inv_model, data1, data2)">inv_kalman_diff</a>	INV_KALMAN_DIFF inverse solver for difference EIT</li><li><a href="../../eidors/algorithms/a_adler/noser_image_prior.html" class="code" title="function Reg= noser_image_prior( inv_model );">noser_image_prior</a>	NOSER_IMAGE_PRIOR calculate image prior</li><li><a href="../../eidors/algorithms/a_adler/time_prior_solve.html" class="code" title="function img= time_prior_solve( inv_model, data1, data2)">time_prior_solve</a>	TIME_PRIOR_SOLVE inverse solver to account for time differences</li><li><a href="../../eidors/algorithms/a_adler/time_smooth_prior.html" class="code" title="function Reg= time_smooth_prior( inv_model );">time_smooth_prior</a>	TIME_SMOOTH_PRIOR calculate image prior</li><li><a href="../../eidors/algorithms/n_polydorides/np_inv_solve.html" class="code" title="function img= np_inv_solve( inv_model, data1, data2)">np_inv_solve</a>	NP_INV_SOLVE inverse solver for Nick Polydorides EIDORS3D code</li><li><a href="../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG: eidors progress and status messages</li><li><a href="../../eidors/graphics_matlab/animate_reconstructions.html" class="code" title="function fname_out= animate_reconstructions(fname, imgs);">animate_reconstructions</a>	animate_reconstructions(fname, imgs);</li><li><a href="../../eidors/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>	INV_SOLVE: calculate imag from an inv_model and data</li><li><a href="../../eidors/models/a_adler/add_noise.html" class="code" title="function vv = add_noise( SNR, v1, v2, options)">add_noise</a>	ADD_NOISE: Add a given SNR to EIDORS data</li><li><a href="../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../eidors/models/a_adler/mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>	MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function ve= extract_subframes( vv, subseq)</a></li><li><a href="#_sub2" class="code">function ve = repack_subframes(vv,subseq);</a></li><li><a href="#_sub3" class="code">function vv= remove_curr_elecs(vv)</a></li><li><a href="#_sub4" class="code">function imdl= set_basic( shape_str, type, vals )</a></li><li><a href="#_sub5" class="code">function [vi,vh]= add_noise(vi,vh,snr_mult)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function imgs= moving_tank_objs(data_sel, inv_sel, options)</a>
0002 <span class="comment">% MOVING_TANK_OBJS: create movies of objects moving in tanks</span>
0003 <span class="comment">% Usage:</span>
0004 <span class="comment">% imgs= moving_tank_objs(data_sel, inv_sel, options)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% imgs = reconstructed images</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% data_sel select data_sel to use</span>
0009 <span class="comment">%   data_sel: 10 =&gt; target across tank data</span>
0010 <span class="comment">%             20 =&gt; target around tank data</span>
0011 <span class="comment">%             21 =&gt; target around tank data (10 positions)</span>
0012 <span class="comment">%             30 =&gt; from netgen simulations (spiral)</span>
0013 <span class="comment">%             32 =&gt; from netgen simulations (spirograph)</span>
0014 <span class="comment">%             40 =&gt; show netgen FEM simulation</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%   if data_sel is a vector of EIT data, then it will</span>
0017 <span class="comment">%      be used for the reconstruction. The first measurement</span>
0018 <span class="comment">%      is the homogeneous, and the next are the data</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% inv_sel</span>
0021 <span class="comment">%  2D reconstructions</span>
0022 <span class="comment">%   inv_sel = 1   =&gt; aa_inv_solve</span>
0023 <span class="comment">%   inv_sel = 1.1 =&gt; aa_inv_solve (576 elems)</span>
0024 <span class="comment">%   inv_sel = 2   =&gt; inv_kalman_diff</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   if inv_sel is a inv_model structure, then use it to</span>
0027 <span class="comment">%   do reconstructions.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% options (not changed if value is NaN);</span>
0030 <span class="comment">%   options(1) - noise figure</span>
0031 <span class="comment">%   options(2) - time_steps</span>
0032 <span class="comment">%   options(3) - time_weight</span>
0033 <span class="comment">%</span>
0034 <span class="comment">% Create moving objects and tanks</span>
0035 <span class="comment">% $Id$</span>
0036 
0037 clim= [];
0038 
0039 <span class="keyword">if</span> nargin&lt;1; data_sel = 10; <span class="keyword">end</span>
0040 <span class="keyword">if</span> nargin&lt;2; inv_sel  = 1; <span class="keyword">end</span>
0041 
0042 <span class="keyword">if</span> isnumeric(data_sel) &amp; size(data_sel)==[1,1]
0043   <span class="keyword">switch</span> data_sel
0044     <span class="keyword">case</span> 10
0045         load montreal_data_1995;
0046         vh= zc_h_demo4;
0047         vi= zc_demo4;
0048         filename= <span class="string">'target-across'</span>;
0049 
0050     <span class="keyword">case</span> 20
0051         load montreal_data_1995;
0052         vh= zc_h_demo3;
0053         vi= zc_demo3;
0054         filename= <span class="string">'target-around'</span>;
0055 
0056     <span class="keyword">case</span> 21
0057         load montreal_data_1995;
0058         vh= zc_h_demo3;
0059         vi= zc_demo3(:,1:2:20);
0060         filename= <span class="string">'target-around10'</span>;
0061 
0062     <span class="keyword">case</span> 22
0063         load iirc_data_2006
0064         vh= real(v_reference);
0065         vi= real(v_rotate(:,1:30));
0066         filename= <span class="string">'iirc-around-clean'</span>;
0067 
0068     <span class="keyword">case</span> 22.1
0069         load iirc_data_2006
0070         vh= v_reference;
0071         vi= v_rotate(:,11:20);
0072         filename= <span class="string">'iirc-around-clean'</span>;
0073 
0074     <span class="keyword">case</span> 23
0075         load iirc_data_2006
0076         vh= v_reference;
0077         vi= v_rotate(:,1:30);
0078         [vi,vh]= <a href="../../eidors/models/a_adler/add_noise.html" class="code" title="function vv = add_noise( SNR, v1, v2, options)">add_noise</a>(vi,vh,2)
0079         filename= <span class="string">'iirc-around-noise'</span>;
0080 
0081       <span class="keyword">case</span> 24
0082         load iirc_data_2006
0083         vh= v_reference;
0084         vi= v_rotate;
0085         filename= <span class="string">'iirc-around-clean'</span>;
0086 
0087 
0088     <span class="keyword">case</span> 30
0089         load netgen_moving_ball
0090         vh= homg_tank;
0091         vi= target_spiral;
0092         filename= <span class="string">'netgen-spiral'</span>;
0093 
0094     <span class="keyword">case</span> 31
0095         load netgen_moving_ball
0096         vh= homg_tank;
0097         vi= target_spiral(40:60);
0098         filename= <span class="string">'netgen-spiral-part'</span>;
0099 
0100     <span class="keyword">case</span> 32
0101         load netgen_moving_ball
0102         vh= homg_tank;
0103         vi= target_spirograph_slow;
0104         filename= <span class="string">'netgen-spirograph-slow'</span>;
0105 
0106     <span class="keyword">case</span> 33
0107         load netgen_moving_ball
0108         vh= homg_tank;
0109         vi= target_spirograph_slow([31:52,72:90]);
0110         randn(<span class="string">'seed'</span>,20);
0111         <span class="keyword">for</span> i=1:length(vi)
0112 <span class="comment">%          vi(i).meas = vi(i).meas + 25e-6*randn(size(vi(i).meas));</span>
0113         <span class="keyword">end</span>
0114         filename= <span class="string">'netgen-spirograph-slow-part'</span>;
0115 
0116     <span class="keyword">otherwise</span>
0117         error(<span class="string">'Don''t recognize data_sel'</span>);
0118   <span class="keyword">end</span>
0119 <span class="keyword">else</span>
0120   vh= data_sel(:,1);
0121   vi= data_sel(:,2:end);
0122   filename= <span class="string">'user-data'</span>;
0123 <span class="keyword">end</span>
0124 
0125 <span class="comment">% noise_figure?</span>
0126 <span class="comment">% Calc BR and posn error</span>
0127 
0128 <span class="keyword">try</span>; <span class="keyword">if</span> inv_sel.type==<span class="string">'inv_model'</span>
0129    imdl= inv_sel;
0130    inv_sel= <span class="string">'set'</span>
0131 <span class="keyword">end</span>; <span class="keyword">end</span>
0132 
0133 <span class="keyword">switch</span> inv_sel
0134     <span class="keyword">case</span> <span class="string">'set'</span>
0135         <a href="../../eidors/eidors_msg.html" class="code" title="function log_level= eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'Using imdl=%s'</span>,imdl.name,2);
0136 
0137     <span class="keyword">case</span> 1
0138         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span> );
0139 
0140     <span class="keyword">case</span> 1.1
0141         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'c2c'</span> );
0142 
0143     <span class="keyword">case</span> 1.2
0144         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'d2c'</span> );
0145 
0146     <span class="keyword">case</span> 2
0147         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span> );
0148         imdl.solve= @<a href="../../eidors/algorithms/a_adler/inv_kalman_diff.html" class="code" title="function img= inv_kalman_diff( inv_model, data1, data2)">inv_kalman_diff</a>;
0149 
0150     <span class="keyword">case</span> 2.1
0151         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'c2c'</span> );
0152         imdl.solve= @<a href="../../eidors/algorithms/a_adler/inv_kalman_diff.html" class="code" title="function img= inv_kalman_diff( inv_model, data1, data2)">inv_kalman_diff</a>;
0153 
0154     <span class="keyword">case</span> 3
0155         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span> );
0156         imdl.solve= @<a href="../../eidors/algorithms/a_adler/aa_inv_conj_grad.html" class="code" title="function img= aa_inv_conj_grad( inv_model, data1, data2)">aa_inv_conj_grad</a>;
0157 
0158     <span class="keyword">case</span> 4
0159         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span>, <span class="string">'temporal'</span>, [3, .6] );
0160 
0161     <span class="keyword">case</span> 4.1
0162         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'c2c'</span>, <span class="string">'temporal'</span>, [3, .6] );
0163 
0164     <span class="keyword">case</span> 5
0165         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span>, <span class="string">'temporal'</span>, [8, 1] );
0166 
0167     <span class="keyword">case</span> 11
0168         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span> );
0169 
0170         vi = <a href="#_sub1" class="code" title="subfunction ve= extract_subframes( vv, subseq)">extract_subframes</a>(vi,4);
0171         vi = <a href="#_sub2" class="code" title="subfunction ve = repack_subframes(vv,subseq);">repack_subframes</a>(vi,4);
0172 
0173     <span class="keyword">case</span> 11.1
0174         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'c2c'</span> );
0175 
0176         vi = <a href="#_sub1" class="code" title="subfunction ve= extract_subframes( vv, subseq)">extract_subframes</a>(vi,4);
0177         vi = <a href="#_sub2" class="code" title="subfunction ve = repack_subframes(vv,subseq);">repack_subframes</a>(vi,4);
0178 
0179     <span class="keyword">case</span> 12
0180         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span> );
0181         imdl.solve= @<a href="../../eidors/algorithms/a_adler/inv_kalman_diff.html" class="code" title="function img= inv_kalman_diff( inv_model, data1, data2)">inv_kalman_diff</a>;
0182         [imdl.fwd_model.stimulation(:).delta_time]=deal(1);
0183 
0184         vi = <a href="#_sub1" class="code" title="subfunction ve= extract_subframes( vv, subseq)">extract_subframes</a>(vi,4);
0185 
0186     <span class="keyword">case</span> 12.1
0187         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'c2c'</span> );
0188         imdl.solve= @<a href="../../eidors/algorithms/a_adler/inv_kalman_diff.html" class="code" title="function img= inv_kalman_diff( inv_model, data1, data2)">inv_kalman_diff</a>;
0189         [imdl.fwd_model.stimulation(:).delta_time]=deal(1);
0190 
0191         vi = <a href="#_sub1" class="code" title="subfunction ve= extract_subframes( vv, subseq)">extract_subframes</a>(vi,4);
0192 
0193     <span class="keyword">case</span> 14
0194         imdl= <a href="#_sub4" class="code" title="subfunction imdl= set_basic( shape_str, type, vals )">set_basic</a>( <span class="string">'b2c'</span> );
0195         time_steps= 3;
0196 
0197         imdl.RtR_prior= @<a href="../../eidors/algorithms/a_adler/time_smooth_prior.html" class="code" title="function Reg= time_smooth_prior( inv_model );">time_smooth_prior</a>;
0198         imdl.time_smooth_prior.space_prior= @<a href="../../eidors/algorithms/a_adler/noser_image_prior.html" class="code" title="function Reg= noser_image_prior( inv_model );">noser_image_prior</a>;
0199         imdl.time_smooth_prior.time_weight= .5;
0200         imdl.time_smooth_prior.time_steps=  time_steps;
0201 
0202         imdl.solve= @<a href="../../eidors/algorithms/a_adler/time_prior_solve.html" class="code" title="function img= time_prior_solve( inv_model, data1, data2)">time_prior_solve</a>;
0203         imdl.time_prior_solve.time_steps=   time_steps;
0204 
0205         [imdl.fwd_model.stimulation(:).delta_time]=deal(1);
0206 
0207         vi = <a href="#_sub1" class="code" title="subfunction ve= extract_subframes( vv, subseq)">extract_subframes</a>(vi,4);
0208 
0209     <span class="keyword">otherwise</span>
0210         error([<span class="string">'inv_sel ('</span> inv_sel <span class="string">') not recognized'</span>]);
0211 <span class="keyword">end</span>
0212 
0213 <span class="comment">% options</span>
0214 <span class="keyword">if</span> nargin&gt;=3
0215    <span class="keyword">if</span> length(options) &gt;=1 <span class="keyword">if</span> ~isnan(options(1))
0216       imdl= rmfield(imdl,<span class="string">'hyperparameter'</span>);
0217       imdl.hyperparameter.func= @<a href="../../eidors/algorithms/a_adler/choose_noise_figure.html" class="code" title="function HP= choose_noise_figure( inv_model );">choose_noise_figure</a>;
0218       imdl.hyperparameter.tgt_elems= [1:4];
0219       imdl.hyperparameter.noise_figure= options(1);
0220          filename = sprintf(<span class="string">'%s-hp=%g'</span>, filename, options(1));
0221    <span class="keyword">end</span>; <span class="keyword">end</span>
0222    <span class="keyword">if</span> length(options) &gt;=2 <span class="keyword">if</span> ~isnan(options(2))
0223       imdl.time_smooth_prior.time_steps=  options(2);
0224       imdl.time_prior_solve.time_steps=   options(2);
0225       filename = sprintf(<span class="string">'%s-ts=%d'</span>, filename, options(2));
0226    <span class="keyword">end</span>; <span class="keyword">end</span>
0227    <span class="keyword">if</span> length(options) &gt;=3 <span class="keyword">if</span> ~isnan(options(3))
0228       imdl.time_smooth_prior.time_weight=  options(3);
0229       filename = sprintf(<span class="string">'%s-tw=%4.2f'</span>, filename, options(3));
0230    <span class="keyword">end</span>; <span class="keyword">end</span>
0231 <span class="keyword">end</span>
0232 
0233 t=cputime;
0234 imgs= <a href="../../eidors/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>(imdl,vh,vi);
0235 fprintf(<span class="string">'solve time=%f\n'</span>,cputime-t);
0236 <a href="../../eidors/graphics_matlab/animate_reconstructions.html" class="code" title="function fname_out= animate_reconstructions(fname, imgs);">animate_reconstructions</a>(filename, imgs);
0237 
0238 <span class="comment">% original = [ 1.1 2.1 3.1 4.1 5.1</span>
0239 <span class="comment">%              1.2 2.2 3.2 4.2 5.2</span>
0240 <span class="comment">%              1.3 2.3 3.3 4.3 5.3</span>
0241 <span class="comment">%              1.4 2.4 3.4 4.4 5.4</span>
0242 <span class="comment">%              1.5 2.5 3.5 4.5 5.5  ]</span>
0243 <span class="comment">% subseq = 2</span>
0244 <span class="comment">% output   = [ 1.1 3.1</span>
0245 <span class="comment">%              1.2 4.2</span>
0246 <span class="comment">%              2.3 4.3</span>
0247 <span class="comment">%              2.4 5.4</span>
0248 <span class="comment">%              3.5 5.5 ]</span>
0249 <span class="comment">%</span>
0250 <span class="comment">% Hardcoded for 16 electrode 2D adjacent stimulation</span>
0251 <a name="_sub1" href="#_subfunctions" class="code">function ve= extract_subframes( vv, subseq)</a>
0252    vv= <a href="#_sub3" class="code" title="subfunction vv= remove_curr_elecs(vv)">remove_curr_elecs</a>(vv);
0253 
0254    ve= zeros( size(vv,1), floor(size(vv,2)*subseq/16) );
0255    dst=0; src=0;
0256    <span class="keyword">for</span> k=0:16*size(ve,2)-1;
0257       pat = (1:13) + 13*rem(k,16);
0258       <span class="keyword">if</span> 0==rem(k,16);     dst= dst+1; <span class="keyword">end</span>
0259       <span class="keyword">if</span> 0==rem(k,subseq); src= src+1; <span class="keyword">end</span>
0260       ve(pat,dst) = vv(pat, src);
0261    <span class="keyword">end</span>
0262 
0263 
0264 <span class="comment">% original = [ 1.1 2.1 3.1 4.1 5.1</span>
0265 <span class="comment">%              1.2 2.2 3.2 4.2 5.2</span>
0266 <span class="comment">%              1.3 2.3 3.3 4.3 5.3</span>
0267 <span class="comment">%              1.4 2.4 3.4 4.4 5.4</span>
0268 <span class="comment">%              1.5 2.5 3.5 4.5 5.5  ]</span>
0269 <span class="comment">% subseq = 2</span>
0270 <span class="comment">%</span>
0271 <span class="comment">% output   = [ 1.1 2.1 2.1 3.1 3.1</span>
0272 <span class="comment">%              1.2 2.2 2.2 2.2 3.2</span>
0273 <span class="comment">%              1.3 1.3 2.3 2.3 3.3</span>
0274 <span class="comment">%              1.4 1.4 2.4 2.4 2.4</span>
0275 <span class="comment">%              1.5 1.5 1.5 3.5 3.5 ]</span>
0276 <span class="comment">%</span>
0277 <span class="comment">% Hardcoded for 16 electrode 2D adjacent stimulation</span>
0278 
0279 <a name="_sub2" href="#_subfunctions" class="code">function ve = repack_subframes(vv,subseq);</a>
0280    vv= <a href="#_sub3" class="code" title="subfunction vv= remove_curr_elecs(vv)">remove_curr_elecs</a>(vv);
0281 
0282    <span class="comment">% duplicate first and last</span>
0283    ve= zeros( size(vv,1), floor(size(vv,2)*16/subseq) );
0284    vv= vv(:,[1:<span class="keyword">end</span>,end]);
0285    dst=0; src=0;
0286    pat = (1:208)';
0287    <span class="keyword">for</span> i=1:size(ve,2)
0288       <span class="keyword">for</span> k=rem(subseq*i + (-subseq:-1),16);
0289          pat(13*k + (1:13)) = pat(13*k + (1:13)) + 208;
0290       <span class="keyword">end</span>
0291       ve(:,i) = vv(pat);
0292    <span class="keyword">end</span>
0293 
0294 
0295 <a name="_sub3" href="#_subfunctions" class="code">function vv= remove_curr_elecs(vv)</a>
0296    <span class="keyword">if</span> isstruct(vv);
0297       vv= [vv(:).meas];
0298    <span class="keyword">end</span>
0299    [st, els]= <a href="../../eidors/models/a_adler/mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(16, 1, <span class="string">'{ad}'</span>,<span class="string">'{ad}'</span>, {}, 10);
0300 
0301    <span class="comment">% thow away measurements at current elecs if needed</span>
0302    <span class="keyword">if</span> size(vv,1)==size(els,1)
0303       vv= vv(els,:);
0304    <span class="keyword">end</span>
0305 
0306 <a name="_sub4" href="#_subfunctions" class="code">function imdl= set_basic( shape_str, type, vals )</a>
0307    imdl = <a href="../../eidors/models/a_adler/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>( shape_str, 16 );
0308    imdl.RtR_prior= @<a href="../../eidors/algorithms/a_adler/noser_image_prior.html" class="code" title="function Reg= noser_image_prior( inv_model );">noser_image_prior</a>;
0309    imdl.noser_image_prior.exponent= .5;
0310    imdl.solve= @<a href="../../eidors/algorithms/n_polydorides/np_inv_solve.html" class="code" title="function img= np_inv_solve( inv_model, data1, data2)">np_inv_solve</a>;
0311    imdl.hyperparameter.value= 1e-1;
0312 
0313    <span class="keyword">if</span> nargin==1; <span class="keyword">return</span>; <span class="keyword">end</span>
0314 
0315    <span class="keyword">switch</span> type
0316      <span class="keyword">case</span> <span class="string">'temporal'</span>
0317         time_steps= vals(1); 
0318         time_weight= vals(2);
0319 
0320         imdl.RtR_prior= @<a href="../../eidors/algorithms/a_adler/time_smooth_prior.html" class="code" title="function Reg= time_smooth_prior( inv_model );">time_smooth_prior</a>;
0321         imdl.time_smooth_prior.space_prior= @<a href="../../eidors/algorithms/a_adler/noser_image_prior.html" class="code" title="function Reg= noser_image_prior( inv_model );">noser_image_prior</a>;
0322         imdl.time_smooth_prior.time_weight= time_weight;
0323         imdl.time_smooth_prior.time_steps=  time_steps;
0324 
0325         imdl.solve= @<a href="../../eidors/algorithms/a_adler/time_prior_solve.html" class="code" title="function img= time_prior_solve( inv_model, data1, data2)">time_prior_solve</a>;
0326         imdl.time_prior_solve.time_steps=   time_steps;
0327         imdl.hyperparameter.value= 1e-1;
0328 
0329      <span class="keyword">otherwise</span>
0330         error(<span class="string">'dont understand parameter'</span>);
0331    <span class="keyword">end</span>
0332 
0333 <span class="comment">%  Add noise to a data set, snr_mult is # time SNR</span>
0334 <a name="_sub5" href="#_subfunctions" class="code">function [vi,vh]= add_noise(vi,vh,snr_mult)</a>
0335    ll= size(vi,2);
0336    snr= norm(vi)/norm(vi - vh(:,ones(1,ll)));
0337    rand(<span class="string">'seed'</span>,50);
0338    vh= vh+snr*snr_mult*randn(size(vh));
0339    vi= vi+snr*snr_mult*randn(size(vi));</pre></div>
<hr><address>Generated on Tue 09-Aug-2011 11:38:31 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>